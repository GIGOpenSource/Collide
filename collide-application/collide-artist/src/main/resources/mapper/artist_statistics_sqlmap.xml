<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gig.collide.artist.infrastructure.mapper.ArtistStatisticsMapper">
    <resultMap id="BaseResultMap" type="com.gig.collide.artist.domain.entity.ArtistStatistics">
        <result property="id" column="ID"/>
        <result property="gmtCreate" column="GMT_CREATE"/>
        <result property="gmtModified" column="GMT_MODIFIED"/>
        <result property="artistId" column="ARTIST_ID"/>
        <result property="statisticsDate" column="STATISTICS_DATE"/>
        <result property="dailyViews" column="DAILY_VIEWS"/>
        <result property="dailyLikes" column="DAILY_LIKES"/>
        <result property="dailyComments" column="DAILY_COMMENTS"/>
        <result property="dailyShares" column="DAILY_SHARES"/>
        <result property="dailyFollowers" column="DAILY_FOLLOWERS"/>
        <result property="totalViews" column="TOTAL_VIEWS"/>
        <result property="totalLikes" column="TOTAL_LIKES"/>
        <result property="totalComments" column="TOTAL_COMMENTS"/>
        <result property="totalShares" column="TOTAL_SHARES"/>
        <result property="totalFollowers" column="TOTAL_FOLLOWERS"/>
        <result property="engagementRate" column="ENGAGEMENT_RATE"/>
        <result property="growthRate" column="GROWTH_RATE"/>
        <result property="activeScore" column="ACTIVE_SCORE"/>
        <result property="qualityScore" column="QUALITY_SCORE"/>
        <result property="influenceScore" column="INFLUENCE_SCORE"/>
        <result property="deleted" column="DELETED"/>
        <result property="lockVersion" column="LOCK_VERSION"/>
    </resultMap>

    <select id="findById" resultMap="BaseResultMap">
        SELECT * FROM artist_statistics WHERE deleted = 0
        <if test="id != null">AND id = #{id}</if>
    </select>

    <select id="findByArtistId" resultMap="BaseResultMap">
        SELECT * FROM artist_statistics 
        WHERE deleted = 0 AND artist_id = #{artistId}
        ORDER BY statistics_date DESC
        LIMIT 1
    </select>

    <select id="findByArtistIds" resultMap="BaseResultMap">
        SELECT * FROM artist_statistics 
        WHERE deleted = 0 AND artist_id IN
        <foreach collection="list" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
        ORDER BY statistics_date DESC
    </select>
</mapper> 