<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gig.collide.content.infrastructure.mapper.ContentFavoriteMapper">

    <!-- 结果映射 -->
    <resultMap id="BaseResultMap" type="com.gig.collide.content.domain.entity.ContentFavorite">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="content_id" property="contentId" jdbcType="BIGINT"/>
        <result column="user_id" property="userId" jdbcType="BIGINT"/>
        <result column="created_time" property="createdTime" jdbcType="TIMESTAMP"/>
        <result column="deleted" property="deleted" jdbcType="TINYINT"/>
    </resultMap>

    <!-- 基础列 -->
    <sql id="Base_Column_List">
        id, content_id, user_id, created_time, deleted
    </sql>

    <!-- 检查用户是否已经收藏了指定内容 -->
    <select id="existsByContentIdAndUserId" resultType="boolean">
        SELECT COUNT(*) > 0
        FROM t_content_favorite
        WHERE deleted = 0
        AND content_id = #{contentId}
        AND user_id = #{userId}
    </select>

    <!-- 删除用户对指定内容的收藏记录（逻辑删除） -->
    <update id="deleteByContentIdAndUserId">
        UPDATE t_content_favorite
        SET deleted = 1
        WHERE deleted = 0
        AND content_id = #{contentId}
        AND user_id = #{userId}
    </update>

    <!-- 统计指定内容的收藏数量 -->
    <select id="countByContentId" resultType="int">
        SELECT COUNT(*)
        FROM t_content_favorite
        WHERE deleted = 0
        AND content_id = #{contentId}
    </select>

    <!-- 统计用户的收藏数量 -->
    <select id="countByUserId" resultType="int">
        SELECT COUNT(*)
        FROM t_content_favorite
        WHERE deleted = 0
        AND user_id = #{userId}
    </select>

</mapper> 