# 内容模块系统设计文档

## 1. 概述

内容模块是一个独立的内容管理系统，支持多种内容类型（小说、漫画、短视频、长视频），提供完整的内容创建、审核、发布、统计和推荐功能。模块采用无外键约束设计，确保系统的独立性和高性能。

## 2. 功能特性

### 2.1 核心功能
- **多内容类型支持**：小说、漫画、短视频（TikTok风格）、长视频（Bilibili风格）
- **完整审核流程**：支持机器审核和人工审核
- **内容管理**：创建、编辑、删除、发布、下架
- **用户交互**：点赞、收藏、分享、评论、查看
- **数据统计**：多维度统计分析
- **内容推荐**：基于多种策略的推荐系统

### 2.2 技术特性
- **独立模块设计**：无外键约束，避免表连接
- **高性能设计**：多级索引，异步处理
- **扩展性强**：JSON扩展字段支持各类型特有属性
- **审计完整**：完整的操作日志记录

## 3. 架构设计

### 3.1 模块架构
```
Content Module
├── Constants（常量定义）
│   ├── ContentType（内容类型）
│   ├── ContentStatus（内容状态）
│   ├── ContentReviewStatus（审核状态）
│   └── ContentOperateTypeEnum（操作类型）
├── DTOs（数据传输对象）
│   ├── Data（数据类）
│   ├── Request（请求类）
│   └── Response（响应类）
├── Services（服务接口）
│   ├── ContentFacadeService（门面服务）
│   └── ContentRecommendService（推荐服务）
└── Database（数据库设计）
    ├── content（内容主表）
    ├── content_review（审核表）
    ├── content_statistics（统计表）
    ├── content_operation_log（操作日志）
    └── user_content_interaction（用户交互表）
```

### 3.2 数据流设计
```
创建内容 → 提交审核 → 机器审核 → 人工审核 → 发布 → 用户交互 → 数据统计
```

## 4. 数据库设计

### 4.1 核心表结构

#### 4.1.1 内容主表 (content)
存储所有类型的内容基本信息，使用JSON字段存储类型特有属性。

**主要字段：**
- 基本信息：ID、类型、标题、描述、封面、URL
- 状态管理：状态、创建者信息
- 分类标签：标签、分类、原创标识
- 统计数据：查看、点赞、收藏、分享、评论数量
- 评分系统：评分、评分人数
- 推荐算法：热度分数、质量分数、推荐指数

#### 4.1.2 审核表 (content_review)
记录内容审核的完整流程和结果。

**主要特性：**
- 支持多轮审核
- 机器审核和人工审核结合
- 审核优先级管理
- 详细的审核意见和原因

#### 4.1.3 统计表 (content_statistics)
按日期维度统计内容的各项指标。

**统计维度：**
- 用户行为：查看、点赞、收藏、分享、评论
- 视频专用：播放完成率、平均观看时长
- 质量指标：跳出率、留存率
- 商业指标：收入统计

#### 4.1.4 用户交互表 (user_content_interaction)
记录用户与内容的所有交互行为。

**交互类型：**
- view：内容查看
- like：点赞操作
- collect：收藏操作
- share：分享操作
- comment：评论操作

### 4.2 索引设计
针对查询场景设计了多维度索引：
- 内容类型索引：快速筛选内容类型
- 状态索引：审核和发布状态查询
- 创建者索引：用户内容查询
- 时间索引：时间范围查询
- 排序索引：热度、评分等排序查询

## 5. 业务流程

### 5.1 内容创建流程
1. 用户上传内容文件
2. 填写内容基本信息
3. 保存为草稿状态
4. 可选择立即提交审核

### 5.2 审核流程
1. **提交审核**：内容状态变为"待审核"
2. **机器审核**：AI自动检测违规内容
3. **人工审核**：审核员人工检查
4. **审核结果**：通过/拒绝/需要重审
5. **状态更新**：根据审核结果更新内容状态

### 5.3 发布流程
1. 审核通过后自动或手动发布
2. 内容状态变为"已发布"
3. 开始接收用户交互
4. 实时更新统计数据

### 5.4 推荐流程
1. **数据收集**：用户行为、内容属性
2. **特征提取**：标签、分类、统计指标
3. **算法计算**：协同过滤、内容推荐
4. **结果排序**：热度、质量、个性化权重
5. **结果返回**：推荐内容列表

## 6. 内容类型特化

### 6.1 小说类型
- **特有属性**：章节数、字数、连载状态
- **扩展信息**：作者简介、更新频率、完结状态
- **推荐策略**：基于类型、作者、完结状态

### 6.2 漫画类型
- **特有属性**：话数、页数、彩色/黑白
- **扩展信息**：画风、连载状态、更新周期
- **推荐策略**：基于画风、题材、更新频率

### 6.3 短视频类型
- **特有属性**：时长限制（≤60秒）、BGM、特效
- **扩展信息**：拍摄设备、滤镜、标签挑战
- **推荐策略**：基于流行趋势、音乐、话题

### 6.4 长视频类型
- **特有属性**：时长、画质、字幕
- **扩展信息**：系列、剧集、分P信息
- **推荐策略**：基于观看完成率、系列关联

## 7. 性能优化

### 7.1 数据库优化
- **分区策略**：按内容类型和时间分区
- **索引优化**：复合索引覆盖常用查询
- **读写分离**：统计查询使用只读库
- **缓存策略**：热门内容多级缓存

### 7.2 业务优化
- **异步处理**：统计更新、推荐计算异步执行
- **批量操作**：统计数据批量更新
- **预计算**：热门内容列表预计算
- **CDN加速**：内容文件CDN分发

### 7.3 推荐优化
- **实时推荐**：基于用户实时行为
- **离线推荐**：大数据分析用户偏好
- **多路召回**：热门、新内容、个性化多路召回
- **AB测试**：推荐算法效果验证

## 8. 监控与运维

### 8.1 业务监控
- **内容质量**：审核通过率、违规内容比例
- **用户活跃**：内容查看、交互数据
- **性能指标**：接口响应时间、系统吞吐量

### 8.2 数据统计
- **实时统计**：当前在线、实时交互
- **离线统计**：日/周/月维度报表
- **趋势分析**：内容热度趋势、用户偏好变化

### 8.3 告警机制
- **审核积压**：待审核内容超过阈值
- **系统异常**：接口错误率、响应时间异常
- **数据异常**：统计数据波动异常

## 9. 安全设计

### 9.1 内容安全
- **机器审核**：AI识别违规内容
- **人工审核**：专业审核员把关
- **用户举报**：用户举报违规内容
- **黑名单机制**：违规用户和内容黑名单

### 9.2 数据安全
- **权限控制**：基于角色的访问控制
- **操作审计**：完整的操作日志记录
- **数据加密**：敏感数据加密存储
- **备份恢复**：定期数据备份和恢复测试

## 10. 扩展性设计

### 10.1 新内容类型
- **扩展字段**：JSON格式支持新类型属性
- **插件机制**：新类型处理逻辑插件化
- **配置驱动**：通过配置支持新类型

### 10.2 国际化支持
- **多语言内容**：支持多种语言内容
- **地区化推荐**：基于地区的内容推荐
- **文化适配**：内容适配不同文化背景

### 10.3 AI集成
- **智能标签**：AI自动生成内容标签
- **智能推荐**：机器学习优化推荐算法
- **内容生成**：AI辅助内容创作

这个内容模块设计具有高度的独立性、可扩展性和性能，能够满足多种内容类型的管理需求，同时为后续的推荐系统提供了坚实的数据基础。 