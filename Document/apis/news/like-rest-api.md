# ç‚¹èµæ¨¡å— REST API æ–‡æ¡£

## æ¥å£æ¦‚è¿°

ç‚¹èµæ¨¡å—æä¾›å®Œæ•´çš„ç‚¹èµåŠŸèƒ½ï¼Œæ”¯æŒå¯¹å†…å®¹ã€è¯„è®ºã€åŠ¨æ€çš„ç‚¹èµæ“ä½œï¼ŒåŒ…å«åˆ†é¡µæŸ¥è¯¢ã€ç»Ÿè®¡åˆ†æã€æ‰¹é‡æ“ä½œç­‰åŠŸèƒ½ã€‚

**åŸºç¡€è·¯å¾„**: `/api/v1/like`

**ç‰ˆæœ¬**: v2.0.0 (MySQL 8.0 ä¼˜åŒ–ç‰ˆ)

**ç‰¹æ€§**:
- âœ… æ”¯æŒå†…å®¹ã€è¯„è®ºã€åŠ¨æ€ä¸‰ç§ç±»å‹ç‚¹èµ
- âœ… ç”¨æˆ·ã€ç›®æ ‡å¯¹è±¡ã€ä½œè€…ä¸‰ä¸ªç»´åº¦æŸ¥è¯¢
- âœ… æ—¶é—´èŒƒå›´æŸ¥è¯¢å’Œæ‰¹é‡æ“ä½œ
- âœ… åˆ†å¸ƒå¼ç¼“å­˜ä¼˜åŒ–
- âœ… MySQL 8.0 ç´¢å¼•ä¼˜åŒ–

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. æ·»åŠ ç‚¹èµ

**æ¥å£åœ°å€**: `POST /api/v1/like/add`

**æ¥å£æè¿°**: ç”¨æˆ·å¯¹å†…å®¹ã€è¯„è®ºæˆ–åŠ¨æ€è¿›è¡Œç‚¹èµ

**è¯·æ±‚å‚æ•°**:
```json
{
    "userId": 123,
    "likeType": "CONTENT",
    "targetId": 456,
    "targetTitle": "ç¤ºä¾‹å†…å®¹æ ‡é¢˜",
    "targetAuthorId": 789,
    "userNickname": "ç”¨æˆ·æ˜µç§°",
    "userAvatar": "https://example.com/avatar.jpg"
}
```

**å‚æ•°è¯´æ˜**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| userId | Long | âœ… | ç‚¹èµç”¨æˆ·ID |
| likeType | String | âœ… | ç‚¹èµç±»å‹: CONTENT/COMMENT/DYNAMIC |
| targetId | Long | âœ… | ç›®æ ‡å¯¹è±¡ID |
| targetTitle | String | âŒ | ç›®æ ‡å¯¹è±¡æ ‡é¢˜ï¼ˆå†—ä½™ï¼‰ |
| targetAuthorId | Long | âŒ | ç›®æ ‡å¯¹è±¡ä½œè€…IDï¼ˆå†—ä½™ï¼‰ |
| userNickname | String | âŒ | ç”¨æˆ·æ˜µç§°ï¼ˆå†—ä½™ï¼‰ |
| userAvatar | String | âŒ | ç”¨æˆ·å¤´åƒï¼ˆå†—ä½™ï¼‰ |

**å“åº”ç¤ºä¾‹**:
```json
{
    "success": true,
    "code": "200",
    "message": "æ“ä½œæˆåŠŸ",
    "data": {
        "id": 1001,
        "userId": 123,
        "likeType": "CONTENT",
        "targetId": 456,
        "targetTitle": "ç¤ºä¾‹å†…å®¹æ ‡é¢˜",
        "targetAuthorId": 789,
        "userNickname": "ç”¨æˆ·æ˜µç§°",
        "userAvatar": "https://example.com/avatar.jpg",
        "status": "active",
        "createTime": "2024-01-16T10:30:00",
        "updateTime": "2024-01-16T10:30:00"
    }
}
```

---

### 2. å–æ¶ˆç‚¹èµ

**æ¥å£åœ°å€**: `POST /api/v1/like/cancel`

**æ¥å£æè¿°**: å–æ¶ˆç”¨æˆ·çš„ç‚¹èµ

**è¯·æ±‚å‚æ•°**:
```json
{
    "userId": 123,
    "likeType": "CONTENT",
    "targetId": 456
}
```

**å‚æ•°è¯´æ˜**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| userId | Long | âœ… | ç‚¹èµç”¨æˆ·ID |
| likeType | String | âœ… | ç‚¹èµç±»å‹: CONTENT/COMMENT/DYNAMIC |
| targetId | Long | âœ… | ç›®æ ‡å¯¹è±¡ID |

**å“åº”ç¤ºä¾‹**:
```json
{
    "success": true,
    "code": "200",
    "message": "æ“ä½œæˆåŠŸ",
    "data": null
}
```

---

### 3. åˆ‡æ¢ç‚¹èµçŠ¶æ€

**æ¥å£åœ°å€**: `POST /api/v1/like/toggle`

**æ¥å£æè¿°**: æ™ºèƒ½åˆ‡æ¢ç‚¹èµçŠ¶æ€ï¼Œå¦‚æœå·²ç‚¹èµåˆ™å–æ¶ˆï¼Œå¦‚æœæœªç‚¹èµåˆ™æ·»åŠ 

**è¯·æ±‚å‚æ•°**:
```json
{
    "userId": 123,
    "likeType": "CONTENT",
    "targetId": 456,
    "targetTitle": "ç¤ºä¾‹å†…å®¹æ ‡é¢˜",
    "targetAuthorId": 789,
    "userNickname": "ç”¨æˆ·æ˜µç§°",
    "userAvatar": "https://example.com/avatar.jpg"
}
```

**å“åº”ç¤ºä¾‹ï¼ˆç‚¹èµæ“ä½œï¼‰**:
```json
{
    "success": true,
    "code": "200",
    "message": "æ“ä½œæˆåŠŸ",
    "data": {
        "id": 1001,
        "userId": 123,
        "likeType": "CONTENT",
        "targetId": 456,
        "status": "active",
        "createTime": "2024-01-16T10:30:00"
    }
}
```

**å“åº”ç¤ºä¾‹ï¼ˆå–æ¶ˆæ“ä½œï¼‰**:
```json
{
    "success": true,
    "code": "200",
    "message": "æ“ä½œæˆåŠŸ",
    "data": null
}
```

---

### 4. æ£€æŸ¥ç‚¹èµçŠ¶æ€

**æ¥å£åœ°å€**: `POST /api/v1/like/check`

**æ¥å£æè¿°**: æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å¯¹ç›®æ ‡å¯¹è±¡ç‚¹èµ

**è¯·æ±‚å‚æ•°**:
```json
{
    "userId": 123,
    "likeType": "CONTENT",
    "targetId": 456
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "success": true,
    "code": "200",
    "message": "æ“ä½œæˆåŠŸ",
    "data": true
}
```

---

## ğŸ“‹ æŸ¥è¯¢åŠŸèƒ½

### 5. åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·ç‚¹èµè®°å½•

**æ¥å£åœ°å€**: `POST /api/v1/like/user/likes`

**æ¥å£æè¿°**: æŸ¥è¯¢æŒ‡å®šç”¨æˆ·çš„ç‚¹èµè®°å½•åˆ—è¡¨

**è¯·æ±‚å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| userId | Long | âœ… | - | ç”¨æˆ·ID |
| likeType | String | âŒ | null | ç‚¹èµç±»å‹ç­›é€‰ |
| status | String | âŒ | null | çŠ¶æ€ç­›é€‰: active/cancelled |
| currentPage | Integer | âŒ | 1 | å½“å‰é¡µç  |
| pageSize | Integer | âŒ | 10 | é¡µé¢å¤§å° |

**URLç¤ºä¾‹**: 
```
POST /api/v1/like/user/likes?userId=123&likeType=CONTENT&currentPage=1&pageSize=10
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "success": true,
    "code": "200",
    "message": "æ“ä½œæˆåŠŸ",
    "data": {
        "datas": [
            {
                "id": 1001,
                "userId": 123,
                "likeType": "CONTENT",
                "targetId": 456,
                "targetTitle": "ç¤ºä¾‹å†…å®¹æ ‡é¢˜",
                "status": "active",
                "createTime": "2024-01-16T10:30:00"
            }
        ],
        "total": 50,
        "currentPage": 1,
        "pageSize": 10,
        "totalPage": 5
    }
}
```

---

### 6. åˆ†é¡µæŸ¥è¯¢ç›®æ ‡å¯¹è±¡ç‚¹èµè®°å½•

**æ¥å£åœ°å€**: `POST /api/v1/like/target/likes`

**æ¥å£æè¿°**: æŸ¥è¯¢æŒ‡å®šç›®æ ‡å¯¹è±¡çš„ç‚¹èµè®°å½•åˆ—è¡¨

**è¯·æ±‚å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| targetId | Long | âœ… | - | ç›®æ ‡å¯¹è±¡ID |
| likeType | String | âœ… | - | ç‚¹èµç±»å‹ |
| status | String | âŒ | null | çŠ¶æ€ç­›é€‰ |
| currentPage | Integer | âŒ | 1 | å½“å‰é¡µç  |
| pageSize | Integer | âŒ | 10 | é¡µé¢å¤§å° |

**URLç¤ºä¾‹**: 
```
POST /api/v1/like/target/likes?targetId=456&likeType=CONTENT&currentPage=1&pageSize=10
```

**å“åº”æ ¼å¼**: åŒç”¨æˆ·ç‚¹èµè®°å½•æŸ¥è¯¢

---

### 7. åˆ†é¡µæŸ¥è¯¢ä½œè€…ä½œå“ç‚¹èµè®°å½•

**æ¥å£åœ°å€**: `POST /api/v1/like/author/likes`

**æ¥å£æè¿°**: æŸ¥è¯¢æŒ‡å®šä½œè€…ä½œå“çš„ç‚¹èµè®°å½•åˆ—è¡¨

**è¯·æ±‚å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| targetAuthorId | Long | âœ… | - | ä½œå“ä½œè€…ID |
| likeType | String | âŒ | null | ç‚¹èµç±»å‹ç­›é€‰ |
| status | String | âŒ | null | çŠ¶æ€ç­›é€‰ |
| currentPage | Integer | âŒ | 1 | å½“å‰é¡µç  |
| pageSize | Integer | âŒ | 10 | é¡µé¢å¤§å° |

**URLç¤ºä¾‹**: 
```
POST /api/v1/like/author/likes?targetAuthorId=789&likeType=CONTENT&currentPage=1&pageSize=10
```

**å“åº”æ ¼å¼**: åŒç”¨æˆ·ç‚¹èµè®°å½•æŸ¥è¯¢

---

## ğŸ“Š ç»Ÿè®¡åŠŸèƒ½

### 8. ç»Ÿè®¡ç›®æ ‡å¯¹è±¡ç‚¹èµæ•°é‡

**æ¥å£åœ°å€**: `GET /api/v1/like/target/{targetId}/count`

**æ¥å£æè¿°**: ç»Ÿè®¡æŒ‡å®šç›®æ ‡å¯¹è±¡çš„ç‚¹èµæ•°é‡

**è·¯å¾„å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| targetId | Long | âœ… | ç›®æ ‡å¯¹è±¡ID |

**æŸ¥è¯¢å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| likeType | String | âœ… | ç‚¹èµç±»å‹ |

**URLç¤ºä¾‹**: 
```
GET /api/v1/like/target/456/count?likeType=CONTENT
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "success": true,
    "code": "200",
    "message": "æ“ä½œæˆåŠŸ",
    "data": 156
}
```

---

### 9. ç»Ÿè®¡ç”¨æˆ·ç‚¹èµæ•°é‡

**æ¥å£åœ°å€**: `GET /api/v1/like/user/{userId}/count`

**æ¥å£æè¿°**: ç»Ÿè®¡æŒ‡å®šç”¨æˆ·çš„ç‚¹èµæ•°é‡

**è·¯å¾„å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| userId | Long | âœ… | ç”¨æˆ·ID |

**æŸ¥è¯¢å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| likeType | String | âŒ | ç‚¹èµç±»å‹ç­›é€‰ |

**URLç¤ºä¾‹**: 
```
GET /api/v1/like/user/123/count?likeType=CONTENT
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "success": true,
    "code": "200",
    "message": "æ“ä½œæˆåŠŸ",
    "data": 42
}
```

---

### 10. ç»Ÿè®¡ä½œè€…ä½œå“è¢«ç‚¹èµæ•°é‡

**æ¥å£åœ°å€**: `GET /api/v1/like/author/{targetAuthorId}/count`

**æ¥å£æè¿°**: ç»Ÿè®¡æŒ‡å®šä½œè€…ä½œå“çš„è¢«ç‚¹èµæ•°é‡

**è·¯å¾„å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| targetAuthorId | Long | âœ… | ä½œå“ä½œè€…ID |

**æŸ¥è¯¢å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| likeType | String | âŒ | ç‚¹èµç±»å‹ç­›é€‰ |

**URLç¤ºä¾‹**: 
```
GET /api/v1/like/author/789/count?likeType=CONTENT
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "success": true,
    "code": "200",
    "message": "æ“ä½œæˆåŠŸ",
    "data": 1250
}
```

---

## ğŸ” æ‰©å±•åŠŸèƒ½

### 11. æŸ¥è¯¢æ—¶é—´èŒƒå›´å†…çš„ç‚¹èµè®°å½•

**æ¥å£åœ°å€**: `GET /api/v1/like/time-range`

**æ¥å£æè¿°**: æŸ¥è¯¢æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„ç‚¹èµè®°å½•

**æŸ¥è¯¢å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| startTime | DateTime | âœ… | å¼€å§‹æ—¶é—´ (ISO 8601æ ¼å¼) |
| endTime | DateTime | âœ… | ç»“æŸæ—¶é—´ (ISO 8601æ ¼å¼) |
| likeType | String | âŒ | ç‚¹èµç±»å‹ç­›é€‰ |
| status | String | âŒ | çŠ¶æ€ç­›é€‰ |

**URLç¤ºä¾‹**: 
```
GET /api/v1/like/time-range?startTime=2024-01-01T00:00:00&endTime=2024-01-31T23:59:59&likeType=CONTENT
```

**å“åº”ç¤ºä¾‹**:
```json
{
    "success": true,
    "code": "200",
    "message": "æ“ä½œæˆåŠŸ",
    "data": [
        {
            "id": 1001,
            "userId": 123,
            "likeType": "CONTENT",
            "targetId": 456,
            "status": "active",
            "createTime": "2024-01-16T10:30:00"
        }
    ]
}
```

---

### 12. æ‰¹é‡æ£€æŸ¥ç‚¹èµçŠ¶æ€

**æ¥å£åœ°å€**: `POST /api/v1/like/batch/check`

**æ¥å£æè¿°**: æ‰¹é‡æ£€æŸ¥ç”¨æˆ·å¯¹å¤šä¸ªç›®æ ‡å¯¹è±¡çš„ç‚¹èµçŠ¶æ€

**è¯·æ±‚å‚æ•°**:
```json
{
    "userId": 123,
    "likeType": "CONTENT",
    "targetIds": [456, 457, 458, 459]
}
```

**å‚æ•°è¯´æ˜**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| userId | Long | âœ… | ç”¨æˆ·ID |
| likeType | String | âœ… | ç‚¹èµç±»å‹ |
| targetIds | List\<Long\> | âœ… | ç›®æ ‡å¯¹è±¡IDåˆ—è¡¨ |

**å“åº”ç¤ºä¾‹**:
```json
{
    "success": true,
    "code": "200",
    "message": "æ“ä½œæˆåŠŸ",
    "data": {
        "456": true,
        "457": false,
        "458": true,
        "459": false
    }
}
```

---

## ğŸš¨ é”™è¯¯ä»£ç 

| é”™è¯¯ä»£ç  | è¯´æ˜ | HTTPçŠ¶æ€ç  |
|----------|------|------------|
| `USER_NOT_FOUND` | ç”¨æˆ·ä¸å­˜åœ¨ | 400 |
| `AUTHOR_NOT_FOUND` | ä½œè€…ä¸å­˜åœ¨ | 400 |
| `LIKE_PARAM_ERROR` | ç‚¹èµå‚æ•°éªŒè¯å¤±è´¥ | 400 |
| `LIKE_ADD_ERROR` | æ·»åŠ ç‚¹èµå¤±è´¥ | 500 |
| `LIKE_CANCEL_ERROR` | å–æ¶ˆç‚¹èµå¤±è´¥ | 500 |
| `LIKE_TOGGLE_ERROR` | åˆ‡æ¢ç‚¹èµçŠ¶æ€å¤±è´¥ | 500 |
| `LIKE_CHECK_ERROR` | æ£€æŸ¥ç‚¹èµçŠ¶æ€å¤±è´¥ | 500 |
| `USER_LIKES_QUERY_ERROR` | æŸ¥è¯¢ç”¨æˆ·ç‚¹èµè®°å½•å¤±è´¥ | 500 |
| `TARGET_LIKES_QUERY_ERROR` | æŸ¥è¯¢ç›®æ ‡å¯¹è±¡ç‚¹èµè®°å½•å¤±è´¥ | 500 |
| `AUTHOR_LIKES_QUERY_ERROR` | æŸ¥è¯¢ä½œè€…ä½œå“ç‚¹èµè®°å½•å¤±è´¥ | 500 |
| `TARGET_LIKE_COUNT_ERROR` | ç»Ÿè®¡ç›®æ ‡å¯¹è±¡ç‚¹èµæ•°é‡å¤±è´¥ | 500 |
| `USER_LIKE_COUNT_ERROR` | ç»Ÿè®¡ç”¨æˆ·ç‚¹èµæ•°é‡å¤±è´¥ | 500 |
| `AUTHOR_LIKE_COUNT_ERROR` | ç»Ÿè®¡ä½œè€…ä½œå“è¢«ç‚¹èµæ•°é‡å¤±è´¥ | 500 |
| `TIME_RANGE_QUERY_ERROR` | æŸ¥è¯¢æ—¶é—´èŒƒå›´å†…çš„ç‚¹èµè®°å½•å¤±è´¥ | 500 |
| `BATCH_CHECK_ERROR` | æ‰¹é‡æ£€æŸ¥ç‚¹èµçŠ¶æ€å¤±è´¥ | 500 |

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥
- âœ… **ç‚¹èµçŠ¶æ€ç¼“å­˜**: 30åˆ†é’Ÿç¼“å­˜ï¼Œå‡å°‘é‡å¤æŸ¥è¯¢
- âœ… **ç‚¹èµæ•°é‡ç¼“å­˜**: 15åˆ†é’Ÿç¼“å­˜ï¼Œæå‡ç»Ÿè®¡æ¥å£æ€§èƒ½
- âœ… **æ‰¹é‡çŠ¶æ€ç¼“å­˜**: 10åˆ†é’Ÿç¼“å­˜ï¼Œä¼˜åŒ–æ‰¹é‡æŸ¥è¯¢
- âœ… **åˆ†é¡µè®°å½•ç¼“å­˜**: 5åˆ†é’Ÿç¼“å­˜ï¼Œæå‡åˆ—è¡¨æŸ¥è¯¢æ•ˆç‡

### æ•°æ®åº“ä¼˜åŒ–
- âœ… **MySQL 8.0 ç´¢å¼•**: 13ä¸ªä¸“é—¨ä¼˜åŒ–çš„å¤åˆç´¢å¼•
- âœ… **è¦†ç›–ç´¢å¼•**: å‡å°‘å›è¡¨æŸ¥è¯¢ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡
- âœ… **é™åºç´¢å¼•**: ä¼˜åŒ–æ—¶é—´æ’åºæŸ¥è¯¢
- âœ… **å‰ç¼€ç´¢å¼•**: ä¼˜åŒ–å­—ç¬¦ä¸²å­—æ®µæŸ¥è¯¢

### æ¥å£æ€§èƒ½æŒ‡æ ‡
- ğŸ¯ **æ ¸å¿ƒæ¥å£**: å“åº”æ—¶é—´ < 100ms
- ğŸ¯ **æŸ¥è¯¢æ¥å£**: å“åº”æ—¶é—´ < 200ms
- ğŸ¯ **ç»Ÿè®¡æ¥å£**: å“åº”æ—¶é—´ < 150ms
- ğŸ¯ **æ‰¹é‡æ¥å£**: å“åº”æ—¶é—´ < 300ms

---

## ğŸ“ ä½¿ç”¨è¯´æ˜

1. **è®¤è¯**: æ‰€æœ‰æ¥å£éœ€è¦ç”¨æˆ·è®¤è¯
2. **é™æµ**: æ¯ç”¨æˆ·æ¯åˆ†é’Ÿæœ€å¤š1000æ¬¡è¯·æ±‚
3. **ç‰ˆæœ¬**: é€šè¿‡Acceptå¤´æˆ–URLå‚æ•°æŒ‡å®šç‰ˆæœ¬
4. **ç¼–ç **: ç»Ÿä¸€ä½¿ç”¨UTF-8ç¼–ç 
5. **æ—¶é—´æ ¼å¼**: ISO 8601æ ¼å¼ (YYYY-MM-DDTHH:mm:ss)

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [ç‚¹èµFacadeæ¥å£æ–‡æ¡£](../facade/like-facade-api.md)
- [æ•°æ®åº“è®¾è®¡æ–‡æ¡£](../database/like-schema.md)
- [ç¼“å­˜ç­–ç•¥æ–‡æ¡£](../cache/like-cache.md)

---

**æœ€åæ›´æ–°**: 2024-01-16  
**æ–‡æ¡£ç‰ˆæœ¬**: v2.0.0  
**ç»´æŠ¤å›¢é˜Ÿ**: GIG Team