# Collide æ¶ˆæ¯æœåŠ¡ API æ–‡æ¡£

## æ¦‚è¿°

Collide æ¶ˆæ¯æœåŠ¡æä¾›å®Œæ•´çš„ç§ä¿¡æ¶ˆæ¯å’Œç•™è¨€æ¿åŠŸèƒ½ï¼ŒåŸºäºç®€æ´çš„å•è¡¨è®¾è®¡ï¼Œæ”¯æŒæ–‡æœ¬ã€å›¾ç‰‡ã€æ–‡ä»¶ç­‰å¤šç§æ¶ˆæ¯ç±»å‹ï¼Œä»¥åŠæ¶ˆæ¯å›å¤ã€ç½®é¡¶ã€æœç´¢ç­‰é«˜çº§åŠŸèƒ½ã€‚

**æœåŠ¡ç‰ˆæœ¬**: v2.0.0 (ç®€æ´ç‰ˆ)  
**åŸºç¡€è·¯å¾„**: `/api/v1/message`  
**DubboæœåŠ¡**: `collide-message` (version: 1.0.0)  
**è®¾è®¡ç†å¿µ**: åŸºäºmessage-simple.sqlçš„å•è¡¨è®¾è®¡ï¼Œå®ç°æ ¸å¿ƒç§ä¿¡åŠŸèƒ½

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- **ğŸš€ é«˜æ€§èƒ½ç¼“å­˜**: åŸºäºJetCacheçš„åˆ†å¸ƒå¼ç¼“å­˜ï¼Œæ˜¾è‘—æå‡æ¶ˆæ¯æŸ¥è¯¢é€Ÿåº¦
- **ğŸ’¬ ç§ä¿¡åŠŸèƒ½**: æ”¯æŒä¸€å¯¹ä¸€ç§ä¿¡é€šä¿¡ï¼Œå¤šç§æ¶ˆæ¯ç±»å‹
- **ğŸ“ ç•™è¨€æ¿**: ç”¨æˆ·ä¸ªäººé¡µé¢ç•™è¨€åŠŸèƒ½ï¼Œæ”¯æŒç½®é¡¶ç®¡ç†
- **ğŸ’¾ æ¶ˆæ¯å›å¤**: æ”¯æŒå±‚çº§å›å¤å’Œå›å¤é“¾æŸ¥è¯¢
- **ğŸ” æ¶ˆæ¯æœç´¢**: å…¨æ–‡æœç´¢ç”¨æˆ·æ¶ˆæ¯å†…å®¹
- **ğŸ“Š å®æ—¶ç»Ÿè®¡**: æœªè¯»æ¶ˆæ¯æ•°ã€æ¶ˆæ¯ç»Ÿè®¡ç­‰å®æ—¶æ•°æ®
- **ğŸ”„ ä¼šè¯ç®¡ç†**: æ™ºèƒ½ä¼šè¯åˆ—è¡¨ï¼ŒæŒ‰æœ€æ–°æ¶ˆæ¯æ—¶é—´æ’åº

## ğŸ†• v2.0.0 æ–°å¢åŠŸèƒ½

- **ç®€æ´è®¾è®¡**: åŸºäºå•è¡¨è®¾è®¡ï¼Œä¼˜åŒ–æ€§èƒ½å’Œç»´æŠ¤æˆæœ¬
- **JetCacheç¼“å­˜**: å…¨é¢çš„ç¼“å­˜ç­–ç•¥ï¼Œæå‡æ¶ˆæ¯æŸ¥è¯¢æ€§èƒ½
- **APIè®¾è®¡ä¼˜åŒ–**: ç»Ÿä¸€ä½¿ç”¨ `currentPage` å‚æ•°ï¼Œå¯¹é½ç³»ç»Ÿè®¾è®¡é£æ ¼
- **Swaggeræ–‡æ¡£**: å®Œæ•´çš„OpenAPI 3.0æ–‡æ¡£æ”¯æŒ

---

## æ¶ˆæ¯å‘é€ API

### 1. å‘é€æ¶ˆæ¯
**æ¥å£è·¯å¾„**: `POST /api/v1/message/send`  
**æ¥å£æè¿°**: å‘é€ç§ä¿¡æ¶ˆæ¯ï¼Œæ”¯æŒæ–‡æœ¬ã€å›¾ç‰‡ã€æ–‡ä»¶ç­‰ç±»å‹

#### è¯·æ±‚å‚æ•°
```json
{
  "senderId": 12345,                     // å¿…å¡«ï¼Œå‘é€è€…ç”¨æˆ·ID
  "receiverId": 67890,                   // å¿…å¡«ï¼Œæ¥æ”¶è€…ç”¨æˆ·ID
  "messageType": "TEXT",                 // å¿…å¡«ï¼Œæ¶ˆæ¯ç±»å‹ï¼šTEXT/IMAGE/FILE/AUDIO/VIDEO
  "content": "Helloï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ï¼",        // å¿…å¡«ï¼Œæ¶ˆæ¯å†…å®¹
  "extraData": {                         // å¯é€‰ï¼Œæ‰©å±•æ•°æ®
    "fileName": "document.pdf",
    "fileSize": 1024000,
    "filePath": "/uploads/files/xxx.pdf"
  },
  "replyToId": null,                     // å¯é€‰ï¼Œå›å¤çš„æ¶ˆæ¯IDï¼ˆæ™®é€šå‘é€æ—¶ä¸ºnullï¼‰
  "messageCategory": "PRIVATE"           // å¯é€‰ï¼Œæ¶ˆæ¯åˆ†ç±»ï¼šPRIVATE/WALL/SYSTEM
}
```

#### å“åº”ç¤ºä¾‹
**æˆåŠŸå“åº” (200)**:
```json
{
  "success": true,
  "responseCode": "SUCCESS",
  "responseMessage": "æ¶ˆæ¯å‘é€æˆåŠŸ",
  "data": {
    "id": 98765,
    "senderId": 12345,
    "receiverId": 67890,
    "messageType": "TEXT",
    "content": "Helloï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ï¼",
    "status": "SENT",
    "createTime": "2024-01-16T10:30:00",
    "isRead": false,
    "isPinned": false,
    "replyToId": null,
    "messageCategory": "PRIVATE",
    "extraData": {}
  }
}
```

**ç‰¹æ€§è¯´æ˜**:
- âš¡ **å®æ—¶å‘é€**: æ¶ˆæ¯ç«‹å³æŠ•é€’åˆ°æ¥æ”¶æ–¹
- ğŸ”’ **æƒé™éªŒè¯**: è‡ªåŠ¨éªŒè¯å‘é€è€…èº«ä»½å’Œæ¥æ”¶è€…æœ‰æ•ˆæ€§
- ğŸ“ **å¤šç±»å‹æ”¯æŒ**: æ–‡æœ¬ã€å›¾ç‰‡ã€æ–‡ä»¶ã€éŸ³é¢‘ã€è§†é¢‘ç­‰

---

### 2. å›å¤æ¶ˆæ¯
**æ¥å£è·¯å¾„**: `POST /api/v1/message/reply`  
**æ¥å£æè¿°**: å›å¤æŒ‡å®šæ¶ˆæ¯

#### è¯·æ±‚å‚æ•°
```json
{
  "senderId": 67890,                     // å¿…å¡«ï¼Œå›å¤è€…ç”¨æˆ·ID
  "receiverId": 12345,                   // å¿…å¡«ï¼Œæ¥æ”¶è€…ç”¨æˆ·ID
  "messageType": "TEXT",                 // å¿…å¡«ï¼Œæ¶ˆæ¯ç±»å‹
  "content": "è°¢è°¢ä½ çš„æ¶ˆæ¯ï¼",             // å¿…å¡«ï¼Œå›å¤å†…å®¹
  "replyToId": 98765                     // å¿…å¡«ï¼Œè¢«å›å¤çš„æ¶ˆæ¯ID
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "data": {
    "id": 98766,
    "senderId": 67890,
    "receiverId": 12345,
    "messageType": "TEXT",
    "content": "è°¢è°¢ä½ çš„æ¶ˆæ¯ï¼",
    "status": "SENT",
    "createTime": "2024-01-16T10:35:00",
    "replyToId": 98765,
    "messageCategory": "PRIVATE"
  }
}
```

**ç‰¹æ€§è¯´æ˜**:
- ğŸ”— **å›å¤é“¾**: è‡ªåŠ¨å»ºç«‹æ¶ˆæ¯å›å¤å…³ç³»
- ğŸ“ **å›å¤è¿½è¸ª**: æ”¯æŒæŸ¥è¯¢æ¶ˆæ¯çš„æ‰€æœ‰å›å¤

---

## æ¶ˆæ¯æŸ¥è¯¢ API

### 1. è·å–æ¶ˆæ¯è¯¦æƒ…
**æ¥å£è·¯å¾„**: `GET /api/v1/message/{messageId}`  
**æ¥å£æè¿°**: æ ¹æ®æ¶ˆæ¯IDè·å–è¯¦ç»†ä¿¡æ¯

#### è¯·æ±‚å‚æ•°
- **messageId** (path): æ¶ˆæ¯IDï¼Œå¿…å¡«
- **userId** (query): æŸ¥çœ‹è€…ç”¨æˆ·IDï¼Œå¿…å¡«

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "data": {
    "id": 98765,
    "senderId": 12345,
    "receiverId": 67890,
    "messageType": "TEXT",
    "content": "Helloï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ï¼",
    "status": "READ",
    "createTime": "2024-01-16T10:30:00",
    "readTime": "2024-01-16T10:32:00",
    "isRead": true,
    "isPinned": false,
    "replyToId": null,
    "messageCategory": "PRIVATE"
  }
}
```

**ç‰¹æ€§è¯´æ˜**:
- ğŸ”’ **æƒé™æ§åˆ¶**: ä»…æ¶ˆæ¯å‚ä¸è€…å¯æŸ¥çœ‹
- âš¡ **5åˆ†é’Ÿç¼“å­˜**: æ¶ˆæ¯è¯¦æƒ…ç¼“å­˜ï¼Œæå‡æŸ¥è¯¢é€Ÿåº¦

---

### 2. åˆ†é¡µæŸ¥è¯¢æ¶ˆæ¯
**æ¥å£è·¯å¾„**: `POST /api/v1/message/query`  
**æ¥å£æè¿°**: æ ¹æ®æ¡ä»¶åˆ†é¡µæŸ¥è¯¢æ¶ˆæ¯åˆ—è¡¨

#### è¯·æ±‚å‚æ•°
```json
{
  "senderId": 12345,                     // å¯é€‰ï¼Œå‘é€è€…ID
  "receiverId": 67890,                   // å¯é€‰ï¼Œæ¥æ”¶è€…ID
  "messageType": "TEXT",                 // å¯é€‰ï¼Œæ¶ˆæ¯ç±»å‹
  "status": "SENT",                      // å¯é€‰ï¼Œæ¶ˆæ¯çŠ¶æ€ï¼šSENT/READ/deleted
  "isPinned": false,                     // å¯é€‰ï¼Œæ˜¯å¦ç½®é¡¶
  "replyToId": null,                     // å¯é€‰ï¼Œå›å¤çš„æ¶ˆæ¯ID
  "keyword": "å…³é”®è¯",                    // å¯é€‰ï¼Œæœç´¢å…³é”®è¯
  "startTime": "2024-01-15 00:00:00",    // å¯é€‰ï¼Œå¼€å§‹æ—¶é—´
  "endTime": "2024-01-16 23:59:59",      // å¯é€‰ï¼Œç»“æŸæ—¶é—´
  "orderBy": "create_time",              // å¯é€‰ï¼Œæ’åºå­—æ®µ
  "orderDirection": "DESC",              // å¯é€‰ï¼Œæ’åºæ–¹å‘ï¼šASC/DESC
  "currentPage": 1,                      // å¯é€‰ï¼Œå½“å‰é¡µç ï¼Œé»˜è®¤1
  "pageSize": 20                         // å¯é€‰ï¼Œé¡µé¢å¤§å°ï¼Œé»˜è®¤20
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "datas": [
    {
      "id": 98765,
      "senderId": 12345,
      "receiverId": 67890,
      "messageType": "TEXT",
      "content": "Helloï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ï¼",
      "status": "READ",
      "createTime": "2024-01-16T10:30:00",
      "isRead": true
    }
  ],
  "total": 156,
  "currentPage": 1,
  "pageSize": 20,
  "totalPage": 8
}
```

**ç‰¹æ€§è¯´æ˜**:
- âš¡ **10åˆ†é’Ÿç¼“å­˜**: æŸ¥è¯¢ç»“æœç¼“å­˜
- ğŸ” **å¤šæ¡ä»¶æŸ¥è¯¢**: æ”¯æŒå¤šå­—æ®µç»„åˆæŸ¥è¯¢
- ğŸ“„ **åˆ†é¡µä¼˜åŒ–**: é«˜æ•ˆçš„åˆ†é¡µæŸ¥è¯¢æœºåˆ¶

---

### 3. è·å–èŠå¤©è®°å½•
**æ¥å£è·¯å¾„**: `GET /api/v1/message/chat`  
**æ¥å£æè¿°**: è·å–ä¸¤ä¸ªç”¨æˆ·ä¹‹é—´çš„èŠå¤©è®°å½•

#### è¯·æ±‚å‚æ•°
- **userId1** (query): ç”¨æˆ·1 IDï¼Œå¿…å¡«
- **userId2** (query): ç”¨æˆ·2 IDï¼Œå¿…å¡«
- **currentPage** (query): å½“å‰é¡µç ï¼Œå¯é€‰ï¼Œé»˜è®¤1
- **pageSize** (query): é¡µé¢å¤§å°ï¼Œå¯é€‰ï¼Œé»˜è®¤20

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "datas": [
    {
      "id": 98766,
      "senderId": 67890,
      "receiverId": 12345,
      "messageType": "TEXT",
      "content": "è°¢è°¢ä½ çš„æ¶ˆæ¯ï¼",
      "status": "READ",
      "createTime": "2024-01-16T10:35:00",
      "replyToId": 98765
    },
    {
      "id": 98765,
      "senderId": 12345,
      "receiverId": 67890,
      "messageType": "TEXT",
      "content": "Helloï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ï¼",
      "status": "read",
      "createTime": "2024-01-16T10:30:00"
    }
  ],
  "total": 25,
  "currentPage": 1,
  "pageSize": 20,
  "totalPage": 2
}
```

**ç‰¹æ€§è¯´æ˜**:
- âš¡ **15åˆ†é’Ÿç¼“å­˜**: èŠå¤©è®°å½•ç¼“å­˜
- ğŸ•’ **æ—¶é—´æ’åº**: æŒ‰æ—¶é—´å€’åºæ’åˆ—ï¼Œæœ€æ–°æ¶ˆæ¯åœ¨å‰
- ğŸ”’ **éšç§ä¿æŠ¤**: ä»…å‚ä¸èŠå¤©çš„ç”¨æˆ·å¯æŸ¥çœ‹

---

### 4. è·å–ç”¨æˆ·ç•™è¨€æ¿
**æ¥å£è·¯å¾„**: `GET /api/v1/message/wall/{userId}`  
**æ¥å£æè¿°**: è·å–ç”¨æˆ·ä¸ªäººé¡µé¢çš„ç•™è¨€ï¼ˆåŒ…å«ç½®é¡¶æ¶ˆæ¯ï¼‰

#### è¯·æ±‚å‚æ•°
- **userId** (path): ç”¨æˆ·IDï¼Œå¿…å¡«
- **currentPage** (query): å½“å‰é¡µç ï¼Œå¯é€‰ï¼Œé»˜è®¤1
- **pageSize** (query): é¡µé¢å¤§å°ï¼Œå¯é€‰ï¼Œé»˜è®¤20

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "datas": [
    {
      "id": 98770,
      "senderId": 11111,
      "receiverId": 12345,
      "messageType": "TEXT",
      "content": "æ­å–œè·å¾—è®¤è¯ï¼",
      "status": "read",
      "createTime": "2024-01-16T09:00:00",
      "isPinned": true,
      "messageCategory": "WALL"
    },
    {
      "id": 98769,
      "senderId": 22222,
      "receiverId": 12345,
      "messageType": "TEXT", 
      "content": "ä½ çš„æ–‡ç« å†™å¾—å¾ˆæ£’ï¼",
      "status": "read",
      "createTime": "2024-01-16T08:30:00",
      "isPinned": false,
      "messageCategory": "WALL"
    }
  ],
  "total": 45,
  "currentPage": 1,
  "pageSize": 20,
  "totalPage": 3
}
```

**ç‰¹æ€§è¯´æ˜**:
- ğŸ“Œ **ç½®é¡¶ä¼˜å…ˆ**: ç½®é¡¶æ¶ˆæ¯ä¼˜å…ˆæ˜¾ç¤º
- âš¡ **10åˆ†é’Ÿç¼“å­˜**: ç•™è¨€æ¿æ¶ˆæ¯ç¼“å­˜
- ğŸŒ **å…¬å¼€è®¿é—®**: ä»»ä½•ç”¨æˆ·éƒ½å¯æŸ¥çœ‹ä»–äººç•™è¨€æ¿

---

### 5. è·å–æ¶ˆæ¯å›å¤
**æ¥å£è·¯å¾„**: `GET /api/v1/message/replies/{messageId}`  
**æ¥å£æè¿°**: è·å–æŒ‡å®šæ¶ˆæ¯çš„æ‰€æœ‰å›å¤

#### è¯·æ±‚å‚æ•°
- **messageId** (path): åŸæ¶ˆæ¯IDï¼Œå¿…å¡«
- **currentPage** (query): å½“å‰é¡µç ï¼Œå¯é€‰ï¼Œé»˜è®¤1
- **pageSize** (query): é¡µé¢å¤§å°ï¼Œå¯é€‰ï¼Œé»˜è®¤20

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "datas": [
    {
      "id": 98766,
      "senderId": 67890,
      "receiverId": 12345,
      "messageType": "TEXT",
      "content": "è°¢è°¢ä½ çš„æ¶ˆæ¯ï¼",
      "status": "read",
      "createTime": "2024-01-16T10:35:00",
      "replyToId": 98765
    },
    {
      "id": 98767,
      "senderId": 11111,
      "receiverId": 12345,
      "messageType": "TEXT",
      "content": "æˆ‘ä¹Ÿæƒ³å‚ä¸è®¨è®º",
      "status": "SENT",
      "createTime": "2024-01-16T10:40:00",
      "replyToId": 98765
    }
  ],
  "total": 5,
  "currentPage": 1,
  "pageSize": 20,
  "totalPage": 1
}
```

**ç‰¹æ€§è¯´æ˜**:
- âš¡ **15åˆ†é’Ÿç¼“å­˜**: å›å¤åˆ—è¡¨ç¼“å­˜
- ğŸ”— **å›å¤é“¾**: æ¸…æ™°çš„å›å¤å…³ç³»é“¾
- ğŸ•’ **æ—¶é—´æ’åº**: æŒ‰å›å¤æ—¶é—´æ­£åºæ’åˆ—

---

### 6. æœç´¢æ¶ˆæ¯
**æ¥å£è·¯å¾„**: `GET /api/v1/message/search`  
**æ¥å£æè¿°**: åœ¨ç”¨æˆ·æ¶ˆæ¯ä¸­æœç´¢å…³é”®è¯

#### è¯·æ±‚å‚æ•°
- **userId** (query): ç”¨æˆ·IDï¼Œå¿…å¡«
- **keyword** (query): æœç´¢å…³é”®è¯ï¼Œå¿…å¡«
- **currentPage** (query): å½“å‰é¡µç ï¼Œå¯é€‰ï¼Œé»˜è®¤1
- **pageSize** (query): é¡µé¢å¤§å°ï¼Œå¯é€‰ï¼Œé»˜è®¤20

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "datas": [
    {
      "id": 98765,
      "senderId": 12345,
      "receiverId": 67890,
      "messageType": "TEXT",
      "content": "Helloï¼Œå¾ˆé«˜å…´<em>è®¤è¯†</em>ä½ ï¼",     // å…³é”®è¯é«˜äº®
      "status": "read",
      "createTime": "2024-01-16T10:30:00",
      "isRead": true
    }
  ],
  "total": 8,
  "currentPage": 1,
  "pageSize": 20,
  "totalPage": 1
}
```

**ç‰¹æ€§è¯´æ˜**:
- ğŸ” **å…¨æ–‡æœç´¢**: æ”¯æŒæ¶ˆæ¯å†…å®¹å…¨æ–‡æ£€ç´¢
- âš¡ **30åˆ†é’Ÿç¼“å­˜**: æœç´¢ç»“æœç¼“å­˜
- ğŸ¯ **å…³é”®è¯é«˜äº®**: æœç´¢å…³é”®è¯è‡ªåŠ¨é«˜äº®æ˜¾ç¤º

---

## ä¼šè¯ç®¡ç† API

### 1. è·å–ç”¨æˆ·ä¼šè¯åˆ—è¡¨
**æ¥å£è·¯å¾„**: `GET /api/v1/message/sessions/{userId}`  
**æ¥å£æè¿°**: è·å–ç”¨æˆ·çš„æ‰€æœ‰èŠå¤©ä¼šè¯

#### è¯·æ±‚å‚æ•°
- **userId** (path): ç”¨æˆ·IDï¼Œå¿…å¡«
- **currentPage** (query): å½“å‰é¡µç ï¼Œå¯é€‰ï¼Œé»˜è®¤1
- **pageSize** (query): é¡µé¢å¤§å°ï¼Œå¯é€‰ï¼Œé»˜è®¤20

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "datas": [
    {
      "id": 1001,
      "userId": 12345,
      "otherUserId": 67890,
      "otherUserName": "å¼ ä¸‰",
      "otherUserAvatar": "https://example.com/avatar.jpg",
      "lastMessageId": 98766,
      "lastMessageContent": "è°¢è°¢ä½ çš„æ¶ˆæ¯ï¼",
      "lastMessageType": "TEXT",
      "lastMessageTime": "2024-01-16T10:35:00",
      "unreadCount": 2,
      "isDeleted": false,
      "createTime": "2024-01-15T10:00:00",
      "updateTime": "2024-01-16T10:35:00"
    },
    {
      "id": 1002,
      "userId": 12345,
      "otherUserId": 11111,
      "otherUserName": "æå››",
      "otherUserAvatar": "https://example.com/avatar2.jpg",
      "lastMessageId": 98768,
      "lastMessageContent": "æ˜å¤©è§ï¼",
      "lastMessageType": "TEXT",
      "lastMessageTime": "2024-01-16T09:20:00",
      "unreadCount": 0,
      "isDeleted": false
    }
  ],
  "total": 15,
  "currentPage": 1,
  "pageSize": 20,
  "totalPage": 1
}
```

**ç‰¹æ€§è¯´æ˜**:
- âš¡ **20åˆ†é’Ÿç¼“å­˜**: ä¼šè¯åˆ—è¡¨ç¼“å­˜
- ğŸ•’ **æ™ºèƒ½æ’åº**: æŒ‰æœ€æ–°æ¶ˆæ¯æ—¶é—´æ’åº
- ğŸ“Š **æœªè¯»ç»Ÿè®¡**: å®æ—¶æ˜¾ç¤ºæ¯ä¸ªä¼šè¯çš„æœªè¯»æ¶ˆæ¯æ•°
- ğŸ‘¤ **ç”¨æˆ·ä¿¡æ¯**: è‡ªåŠ¨è·å–å¯¹æ–¹ç”¨æˆ·åŸºæœ¬ä¿¡æ¯

---

## æ¶ˆæ¯çŠ¶æ€ API

### 1. æ ‡è®°æ¶ˆæ¯å·²è¯»
**æ¥å£è·¯å¾„**: `PUT /api/v1/message/{messageId}/read`  
**æ¥å£æè¿°**: å°†æŒ‡å®šæ¶ˆæ¯æ ‡è®°ä¸ºå·²è¯»çŠ¶æ€

#### è¯·æ±‚å‚æ•°
- **messageId** (path): æ¶ˆæ¯IDï¼Œå¿…å¡«
- **userId** (query): ç”¨æˆ·IDï¼Œå¿…å¡«

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "responseCode": "SUCCESS",
  "responseMessage": "æ¶ˆæ¯å·²æ ‡è®°ä¸ºå·²è¯»"
}
```

**ç‰¹æ€§è¯´æ˜**:
- âš¡ **å®æ—¶æ›´æ–°**: ç«‹å³æ›´æ–°æ¶ˆæ¯è¯»å–çŠ¶æ€
- ğŸ”„ **ç¼“å­˜åŒæ­¥**: è‡ªåŠ¨æ¸…ç†ç›¸å…³ç¼“å­˜

---

### 2. æ‰¹é‡æ ‡è®°å·²è¯»
**æ¥å£è·¯å¾„**: `PUT /api/v1/message/batch-read`  
**æ¥å£æè¿°**: æ‰¹é‡å°†æ¶ˆæ¯æ ‡è®°ä¸ºå·²è¯»çŠ¶æ€

#### è¯·æ±‚å‚æ•°
```json
{
  "messageIds": [98765, 98766, 98767],   // å¿…å¡«ï¼Œæ¶ˆæ¯IDåˆ—è¡¨
  "userId": 12345                        // ä½œä¸ºqueryå‚æ•°
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "responseCode": "SUCCESS",
  "responseMessage": "æ‰¹é‡æ ‡è®°å·²è¯»æˆåŠŸ"
}
```

**ç‰¹æ€§è¯´æ˜**:
- âš¡ **æ‰¹é‡å¤„ç†**: é«˜æ•ˆå¤„ç†å¤šæ¡æ¶ˆæ¯
- ğŸ”„ **äº‹åŠ¡å®‰å…¨**: ç¡®ä¿æ‰¹é‡æ“ä½œçš„åŸå­æ€§

---

### 3. ç½®é¡¶/å–æ¶ˆç½®é¡¶æ¶ˆæ¯
**æ¥å£è·¯å¾„**: `PUT /api/v1/message/{messageId}/pin`  
**æ¥å£æè¿°**: è®¾ç½®æ¶ˆæ¯çš„ç½®é¡¶çŠ¶æ€ï¼Œç”¨äºç•™è¨€æ¿åŠŸèƒ½

#### è¯·æ±‚å‚æ•°
- **messageId** (path): æ¶ˆæ¯IDï¼Œå¿…å¡«
- **userId** (query): ç”¨æˆ·IDï¼Œå¿…å¡«
- **isPinned** (query): æ˜¯å¦ç½®é¡¶ï¼Œå¿…å¡«

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "responseCode": "SUCCESS",
  "responseMessage": "æ¶ˆæ¯ç½®é¡¶çŠ¶æ€å·²æ›´æ–°"
}
```

**ç‰¹æ€§è¯´æ˜**:
- ğŸ“Œ **ç½®é¡¶ç®¡ç†**: çµæ´»çš„æ¶ˆæ¯ç½®é¡¶åŠŸèƒ½
- ğŸ”’ **æƒé™æ§åˆ¶**: ä»…æ¶ˆæ¯æ¥æ”¶è€…å¯è®¾ç½®ç½®é¡¶
- ğŸ”„ **ç¼“å­˜åˆ·æ–°**: è‡ªåŠ¨åˆ·æ–°ç•™è¨€æ¿ç¼“å­˜

---

### 4. åˆ é™¤æ¶ˆæ¯
**æ¥å£è·¯å¾„**: `DELETE /api/v1/message/{messageId}`  
**æ¥å£æè¿°**: é€»è¾‘åˆ é™¤æŒ‡å®šæ¶ˆæ¯

#### è¯·æ±‚å‚æ•°
- **messageId** (path): æ¶ˆæ¯IDï¼Œå¿…å¡«
- **userId** (query): ç”¨æˆ·IDï¼Œå¿…å¡«

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "responseCode": "SUCCESS",
  "responseMessage": "æ¶ˆæ¯åˆ é™¤æˆåŠŸ"
}
```

**ç‰¹æ€§è¯´æ˜**:
- ğŸ—‘ï¸ **é€»è¾‘åˆ é™¤**: ä¿ç•™æ•°æ®ï¼Œä»…æ›´æ–°çŠ¶æ€
- ğŸ”’ **æƒé™æ§åˆ¶**: ä»…æ¶ˆæ¯å‚ä¸è€…å¯åˆ é™¤
- ğŸ”„ **ç¼“å­˜æ¸…ç†**: è‡ªåŠ¨æ¸…ç†ç›¸å…³ç¼“å­˜

---

## ç»Ÿè®¡ä¿¡æ¯ API

### 1. è·å–æœªè¯»æ¶ˆæ¯æ•°
**æ¥å£è·¯å¾„**: `GET /api/v1/message/unread-count/{userId}`  
**æ¥å£æè¿°**: è·å–ç”¨æˆ·çš„æœªè¯»æ¶ˆæ¯æ€»æ•°

#### è¯·æ±‚å‚æ•°
- **userId** (path): ç”¨æˆ·IDï¼Œå¿…å¡«

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "data": 15
}
```

**ç‰¹æ€§è¯´æ˜**:
- âš¡ **5åˆ†é’Ÿç¼“å­˜**: æœªè¯»æ•°ç»Ÿè®¡ç¼“å­˜
- ğŸ“Š **å®æ—¶ç»Ÿè®¡**: å‡†ç¡®çš„æœªè¯»æ¶ˆæ¯è®¡æ•°

---

### 2. è·å–ä¸ç‰¹å®šç”¨æˆ·çš„æœªè¯»æ¶ˆæ¯æ•°
**æ¥å£è·¯å¾„**: `GET /api/v1/message/unread-count/{userId}/with/{otherUserId}`  
**æ¥å£æè¿°**: è·å–ä¸æŸä¸ªç”¨æˆ·çš„æœªè¯»æ¶ˆæ¯æ•°

#### è¯·æ±‚å‚æ•°
- **userId** (path): ç”¨æˆ·IDï¼Œå¿…å¡«
- **otherUserId** (path): å¯¹æ–¹ç”¨æˆ·IDï¼Œå¿…å¡«

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "data": 3
}
```

**ç‰¹æ€§è¯´æ˜**:
- âš¡ **5åˆ†é’Ÿç¼“å­˜**: ç”¨æˆ·é—´æœªè¯»æ•°ç¼“å­˜
- ğŸ¯ **ç²¾ç¡®ç»Ÿè®¡**: ç‰¹å®šä¼šè¯çš„æœªè¯»æ¶ˆæ¯æ•°

---

### 3. è·å–æ¶ˆæ¯ç»Ÿè®¡ä¿¡æ¯
**æ¥å£è·¯å¾„**: `GET /api/v1/message/statistics/{userId}`  
**æ¥å£æè¿°**: è·å–ç”¨æˆ·çš„æ¶ˆæ¯ç»Ÿè®¡æ•°æ®

#### è¯·æ±‚å‚æ•°
- **userId** (path): ç”¨æˆ·IDï¼Œå¿…å¡«

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "data": {
    "totalSent": 1250,                   // æ€»å‘é€æ¶ˆæ¯æ•°
    "totalReceived": 890,                // æ€»æ¥æ”¶æ¶ˆæ¯æ•°
    "unreadCount": 15,                   // æœªè¯»æ¶ˆæ¯æ•°
    "activeSessionCount": 8,             // æ´»è·ƒä¼šè¯æ•°
    "todaySent": 25,                     // ä»Šæ—¥å‘é€æ•°
    "todayReceived": 18,                 // ä»Šæ—¥æ¥æ”¶æ•°
    "weekSent": 156,                     // æœ¬å‘¨å‘é€æ•°
    "weekReceived": 123,                 // æœ¬å‘¨æ¥æ”¶æ•°
    "monthSent": 678,                    // æœ¬æœˆå‘é€æ•°
    "monthReceived": 545,                // æœ¬æœˆæ¥æ”¶æ•°
    "wallMessageCount": 45,              // ç•™è¨€æ¿æ¶ˆæ¯æ•°
    "pinnedMessageCount": 3,             // ç½®é¡¶æ¶ˆæ¯æ•°
    "lastMessageTime": "2024-01-16T10:35:00"  // æœ€åæ¶ˆæ¯æ—¶é—´
  }
}
```

**ç‰¹æ€§è¯´æ˜**:
- âš¡ **30åˆ†é’Ÿç¼“å­˜**: ç»Ÿè®¡æ•°æ®ç¼“å­˜
- ğŸ“Š **å…¨é¢ç»Ÿè®¡**: å¤šç»´åº¦çš„æ¶ˆæ¯æ•°æ®åˆ†æ
- ğŸ•’ **æ—¶é—´ç»´åº¦**: æŒ‰æ—¥ã€å‘¨ã€æœˆçš„ç»Ÿè®¡æ•°æ®

---

## ğŸš€ ç¼“å­˜æ€§èƒ½ç‰¹æ€§

### ç¼“å­˜ç­–ç•¥
- **æ¶ˆæ¯è¯¦æƒ…ç¼“å­˜**: 5åˆ†é’Ÿï¼Œæå‡å•æ¡æ¶ˆæ¯æŸ¥è¯¢é€Ÿåº¦
- **æ¶ˆæ¯åˆ—è¡¨ç¼“å­˜**: 10åˆ†é’Ÿï¼Œä¼˜åŒ–åˆ—è¡¨æŸ¥è¯¢æ€§èƒ½
- **èŠå¤©è®°å½•ç¼“å­˜**: 15åˆ†é’Ÿï¼ŒåŠ é€Ÿä¼šè¯æ¶ˆæ¯åŠ è½½
- **ä¼šè¯åˆ—è¡¨ç¼“å­˜**: 20åˆ†é’Ÿï¼Œå¿«é€Ÿæ˜¾ç¤ºç”¨æˆ·ä¼šè¯
- **æœç´¢ç»“æœç¼“å­˜**: 30åˆ†é’Ÿï¼Œä¼˜åŒ–æœç´¢å“åº”æ—¶é—´
- **ç»Ÿè®¡æ•°æ®ç¼“å­˜**: 30åˆ†é’Ÿï¼Œå‡å°‘ç»Ÿè®¡æŸ¥è¯¢å‹åŠ›
- **æœªè¯»æ•°ç¼“å­˜**: 5åˆ†é’Ÿï¼Œå®æ—¶æ›´æ–°æœªè¯»æ¶ˆæ¯æ•°

### ç¼“å­˜ä¼˜åŒ–
- **åˆ†å¸ƒå¼ç¼“å­˜**: åŸºäºJetCacheçš„åˆ†å¸ƒå¼ç¼“å­˜æ¶æ„
- **æ™ºèƒ½å¤±æ•ˆ**: æ¶ˆæ¯çŠ¶æ€å˜æ›´æ—¶è‡ªåŠ¨æ¸…ç†ç›¸å…³ç¼“å­˜
- **ç¼“å­˜é¢„çƒ­**: ç³»ç»Ÿè‡ªåŠ¨é¢„çƒ­çƒ­é—¨ä¼šè¯æ•°æ®
- **æ€§èƒ½ç›‘æ§**: å®æ—¶ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡å’Œå“åº”æ—¶é—´

### æ€§èƒ½æŒ‡æ ‡
- **æ¶ˆæ¯æŸ¥è¯¢å“åº”æ—¶é—´**: < 50ms (ç¼“å­˜å‘½ä¸­)
- **ç¼“å­˜å‘½ä¸­ç‡**: > 90%
- **å¹¶å‘æ”¯æŒ**: 5,000+ å¹¶å‘æ¶ˆæ¯å¤„ç†
- **æ•°æ®åŒæ­¥**: ç¼“å­˜æ•°æ®ä¸æ•°æ®åº“å®æ—¶åŒæ­¥

---

## é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| INVALID_PARAM | è¯·æ±‚å‚æ•°æ— æ•ˆ |
| SEND_FAILED | æ¶ˆæ¯å‘é€å¤±è´¥ |
| MESSAGE_NOT_FOUND | æ¶ˆæ¯ä¸å­˜åœ¨ |
| ACCESS_DENIED | æ— æƒé™è®¿é—® |
| MARK_FAILED | æ ‡è®°å·²è¯»å¤±è´¥ |
| BATCH_MARK_FAILED | æ‰¹é‡æ ‡è®°å·²è¯»å¤±è´¥ |
| DELETE_FAILED | åˆ é™¤æ¶ˆæ¯å¤±è´¥ |
| PIN_FAILED | è®¾ç½®ç½®é¡¶å¤±è´¥ |
| USER_NOT_FOUND | ç”¨æˆ·ä¸å­˜åœ¨ |
| RECEIVER_NOT_FOUND | æ¥æ”¶è€…ä¸å­˜åœ¨ |
| INVALID_MESSAGE_TYPE | æ— æ•ˆçš„æ¶ˆæ¯ç±»å‹ |
| MESSAGE_TOO_LONG | æ¶ˆæ¯å†…å®¹è¿‡é•¿ |
| REPLY_TARGET_NOT_FOUND | å›å¤ç›®æ ‡æ¶ˆæ¯ä¸å­˜åœ¨ |
| SEND_TO_SELF_ERROR | ä¸èƒ½ç»™è‡ªå·±å‘é€æ¶ˆæ¯ |
| SYSTEM_ERROR | ç³»ç»Ÿé”™è¯¯ |

---

## ğŸ”„ APIè®¾è®¡åŸåˆ™

### ç»Ÿä¸€å“åº”æ ¼å¼
- **æŸ¥è¯¢æ“ä½œ**: ç›´æ¥è¿”å› `PageResponse<Data>` æ ¼å¼
- **åˆ›å»ºæ“ä½œ**: è¿”å› `Result<Data>` æ ¼å¼ï¼ˆåŒ…å«åˆ›å»ºçš„æ•°æ®ï¼‰
- **çŠ¶æ€æ›´æ–°æ“ä½œ**: è¿”å› `Result<Void>` æ ¼å¼ï¼ˆä»…çŠ¶æ€ç ï¼‰

### åˆ†é¡µå‚æ•°è§„èŒƒ
- **currentPage**: å½“å‰é¡µç ï¼Œä»1å¼€å§‹
- **pageSize**: æ¯é¡µå¤§å°ï¼Œé»˜è®¤20ï¼Œæœ€å¤§100
- **total**: æ€»è®°å½•æ•°
- **totalPage**: æ€»é¡µæ•°

### ç¼“å­˜é”®å‘½åè§„èŒƒ
- **æ ¼å¼**: `message:åŠŸèƒ½:å‚æ•°`
- **ç¤ºä¾‹**: `message:detail:id:98765`, `message:chat:user1:12345:user2:67890`
- **è¿‡æœŸç­–ç•¥**: æ ¹æ®æ•°æ®æ›´æ–°é¢‘ç‡è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´

### æ¶ˆæ¯ç±»å‹è§„èŒƒ
- **TEXT**: æ–‡æœ¬æ¶ˆæ¯
- **IMAGE**: å›¾ç‰‡æ¶ˆæ¯
- **FILE**: æ–‡ä»¶æ¶ˆæ¯
- **AUDIO**: éŸ³é¢‘æ¶ˆæ¯
- **VIDEO**: è§†é¢‘æ¶ˆæ¯

### æ¶ˆæ¯çŠ¶æ€è§„èŒƒ
- **SENT**: å·²å‘é€
- **READ**: å·²è¯»
- **DELETED**: å·²åˆ é™¤

### æ¶ˆæ¯åˆ†ç±»è§„èŒƒ
- **PRIVATE**: ç§ä¿¡æ¶ˆæ¯
- **WALL**: ç•™è¨€æ¿æ¶ˆæ¯
- **SYSTEM**: ç³»ç»Ÿæ¶ˆæ¯

---

**æœ€åæ›´æ–°**: 2024-01-16  
**æ–‡æ¡£ç‰ˆæœ¬**: v2.0.0
