# ====================================================================================
# Elasticsearch å…¨å±€é…ç½®æ–‡ä»¶
# ====================================================================================
# åŸºäºé¡¹ç›®SQLç»“æ„åˆ†æï¼Œä¸ºæ‰€æœ‰æ ¸å¿ƒå®ä½“æä¾›ESç´¢å¼•é…ç½®
# æ”¯æŒå®ä½“ï¼šç”¨æˆ·ã€è‰ºæœ¯å®¶ã€å†…å®¹ã€è—å“ã€ç›²ç›’ã€è®¢å•ç­‰
# ====================================================================================

elasticsearch:
  # ====================================================================================
  # å…¨å±€é…ç½®
  # ====================================================================================
  global_settings:
    # é»˜è®¤åˆ†ç‰‡é…ç½®
    default_shards: 1
    default_replicas: 0
    
    # åˆ·æ–°é—´éš”
    refresh_interval: "1s"
    
    # æ˜ å°„æ€»å­—æ®µæ•°é™åˆ¶
    max_fields: 2000
    
    # ç´¢å¼•å‘½åè§„åˆ™
    index_prefix: "collide_"
    
    # æ—¥æœŸæ ¼å¼
    date_formats:
      - "yyyy-MM-dd HH:mm:ss"
      - "strict_date_optional_time"
      - "epoch_millis"

  # ====================================================================================
  # åˆ†æå™¨é…ç½®
  # ====================================================================================
  analyzers:
    # ä¸­æ–‡æ–‡æœ¬åˆ†æå™¨
    chinese_text_analyzer:
      tokenizer: "ik_max_word"
      filter:
        - "lowercase"
        - "stop"
    
    # ä¸­æ–‡æœç´¢åˆ†æå™¨  
    chinese_search_analyzer:
      tokenizer: "ik_smart"
      filter:
        - "lowercase"
        - "stop"
    
    # æ ‡å‡†æ–‡æœ¬åˆ†æå™¨
    standard_text_analyzer:
      tokenizer: "standard"
      filter:
        - "lowercase"
        - "stop"
    
    # å…³é”®è¯åˆ†æå™¨
    keyword_analyzer:
      tokenizer: "keyword"
      filter:
        - "lowercase"

  # ====================================================================================
  # ç´¢å¼•æ¨¡æ¿é…ç½®
  # ====================================================================================
  index_templates:
    # é»˜è®¤æ¨¡æ¿
    default_template:
      index_patterns: ["collide_*"]
      settings:
        number_of_shards: 1
        number_of_replicas: 0
        refresh_interval: "1s"
        analysis:
          analyzer:
            chinese_text:
              tokenizer: "ik_max_word"
              filter: ["lowercase", "stop"]
            chinese_search:
              tokenizer: "ik_smart" 
              filter: ["lowercase", "stop"]
            standard_text:
              tokenizer: "standard"
              filter: ["lowercase", "stop"]

  # ====================================================================================
  # å®ä½“ç´¢å¼•æ˜ å°„é…ç½®
  # ====================================================================================
  indexes:
    
    # ğŸ‘¤ ç”¨æˆ·ç´¢å¼•
    collide_users:
      settings:
        number_of_shards: 1
        number_of_replicas: 0
      mappings:
        properties:
          # åŸºç¡€å­—æ®µ
          id: { type: "long" }
          gmt_create: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          gmt_modified: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          deleted: { type: "integer" }
          lock_version: { type: "integer" }
          
          # ç”¨æˆ·åŸºç¡€ä¿¡æ¯
          user_name: 
            type: "text"
            analyzer: "standard_text"
            fields:
              keyword: { type: "keyword" }
          nick_name:
            type: "text" 
            analyzer: "chinese_text"
            search_analyzer: "chinese_search"
            fields:
              keyword: { type: "keyword" }
          password: { type: "keyword", index: false }
          password_hash: { type: "keyword", index: false }
          state: { type: "keyword" }
          invite_code: { type: "keyword" }
          telephone: { type: "keyword" }
          inviter_id: { type: "keyword" }
          last_login_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          
          # ç”¨æˆ·èµ„æ–™
          profile_photo_url: { type: "keyword", index: false }
          real_name: 
            type: "text"
            analyzer: "chinese_text"
            fields:
              keyword: { type: "keyword" }
          id_card_no: { type: "keyword", index: false }
          
          # åŒºå—é“¾ç›¸å…³
          block_chain_url: { type: "keyword" }
          block_chain_platform: { type: "keyword" }
          
          # çŠ¶æ€æ ‡è¯†
          is_blog_up: { type: "boolean" }
          certification: { type: "boolean" }
          user_role: { type: "keyword" }

    # ğŸ¨ è‰ºæœ¯å®¶ç´¢å¼•
    collide_artist:
      settings:
        number_of_shards: 1
        number_of_replicas: 0
      mappings:
        properties:
          # åŸºç¡€å­—æ®µ
          id: { type: "long" }
          gmt_create: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          gmt_modified: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          deleted: { type: "integer" }
          lock_version: { type: "integer" }
          
          # è‰ºæœ¯å®¶ä¿¡æ¯
          user_id: { type: "long" }
          artist_name:
            type: "text"
            analyzer: "chinese_text"
            search_analyzer: "chinese_search"
            fields:
              keyword: { type: "keyword" }
          bio:
            type: "text"
            analyzer: "chinese_text"
            search_analyzer: "chinese_search"
          status: { type: "keyword" }
          application_type: { type: "keyword" }
          level: { type: "keyword" }
          
          # åª’ä½“URL
          avatar_url: { type: "keyword", index: false }
          cover_url: { type: "keyword", index: false }
          personal_url: { type: "keyword" }
          
          # ç»Ÿè®¡æ•°æ®
          followers_count: { type: "integer" }
          following_count: { type: "integer" }
          works_count: { type: "integer" }
          total_likes: { type: "long" }
          total_views: { type: "long" }
          
          # è®¤è¯ä¿¡æ¯
          verified: { type: "boolean" }
          verification_type: { type: "keyword" }
          verification_desc: { type: "text", analyzer: "chinese_text" }
          
          # è”ç³»æ–¹å¼
          contact_email: { type: "keyword" }
          contact_phone: { type: "keyword" }
          
          # JSONå­—æ®µ
          categories: { type: "keyword" }
          social_media_accounts: { type: "text", index: false }
          expertise_tags: { type: "keyword" }
          collaboration_intent: { type: "text", analyzer: "chinese_text" }
          ext_info: { type: "text", index: false }
          
          # è¯„åˆ†å­—æ®µ
          hot_score: { type: "float" }
          influence_index: { type: "float" }
          last_active_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }

    # ğŸ“ å†…å®¹ç´¢å¼•
    collide_content:
      settings:
        number_of_shards: 1
        number_of_replicas: 0
      mappings:
        properties:
          # åŸºç¡€å­—æ®µ
          id: { type: "long" }
          create_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          update_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          
          # å†…å®¹åŸºç¡€ä¿¡æ¯
          content_type: { type: "keyword" }
          title:
            type: "text"
            analyzer: "chinese_text"
            search_analyzer: "chinese_search"
            fields:
              keyword: { type: "keyword" }
          description:
            type: "text"
            analyzer: "chinese_text"
            search_analyzer: "chinese_search"
          
          # åª’ä½“ä¿¡æ¯
          cover_image: { type: "keyword", index: false }
          content_url: { type: "keyword", index: false }
          duration: { type: "integer" }
          file_size: { type: "long" }
          
          # çŠ¶æ€å’Œåˆ†ç±»
          status: { type: "keyword" }
          category: { type: "keyword" }
          language: { type: "keyword" }
          age_rating: { type: "keyword" }
          is_original: { type: "boolean" }
          
          # åˆ›ä½œè€…ä¿¡æ¯
          creator_user_id: { type: "long" }
          creator_username: 
            type: "text"
            analyzer: "chinese_text"
            fields:
              keyword: { type: "keyword" }
          
          # æ ‡ç­¾ï¼ˆJSONæ•°ç»„ï¼‰
          tags: { type: "keyword" }
          
          # ç»Ÿè®¡æ•°æ®
          view_count: { type: "long" }
          like_count: { type: "long" }
          collect_count: { type: "long" }
          share_count: { type: "long" }
          comment_count: { type: "long" }
          download_count: { type: "long" }
          
          # è¯„åˆ†æ•°æ®
          rating: { type: "float" }
          rating_count: { type: "long" }
          hot_score: { type: "float" }
          quality_score: { type: "float" }
          recommend_index: { type: "float" }
          
          # æ—¶é—´
          publish_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          
          # æ‰©å±•ä¿¡æ¯
          extend_info: { type: "text", index: false }

    # ğŸ’ è—å“ç´¢å¼•ï¼ˆå·²å­˜åœ¨ï¼Œå®Œå–„é…ç½®ï¼‰
    collide_collection:
      settings:
        number_of_shards: 1
        number_of_replicas: 0
      mappings:
        properties:
          # åŸºç¡€å­—æ®µ
          id: { type: "long" }
          gmt_create: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          gmt_modified: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          deleted: { type: "integer" }
          lock_version: { type: "integer" }
          
          # è—å“åŸºç¡€ä¿¡æ¯
          name:
            type: "text"
            analyzer: "chinese_text"
            search_analyzer: "chinese_search"
            fields:
              keyword: { type: "keyword" }
          cover: { type: "keyword", index: false }
          class_id: { type: "keyword" }
          detail:
            type: "text"
            analyzer: "chinese_text"
            search_analyzer: "chinese_search"
          
          # ä»·æ ¼å’Œæ•°é‡
          price: { type: "double" }
          quantity: { type: "integer" }
          saleable_inventory: { type: "long" }
          occupied_inventory: { type: "long" }
          frozen_inventory: { type: "long" }
          
          # çŠ¶æ€å’Œæ ‡è¯†
          state: { type: "keyword" }
          identifier: { type: "keyword" }
          creator_id: { type: "keyword" }
          version: { type: "integer" }
          
          # æ—¶é—´å­—æ®µ
          create_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          sale_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          sync_chain_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          book_start_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          book_end_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          
          # é¢„çº¦ç›¸å…³
          can_book: { type: "integer" }

    # ğŸ“¦ ç›²ç›’ç´¢å¼•
    collide_blind_box:
      settings:
        number_of_shards: 1
        number_of_replicas: 0
      mappings:
        properties:
          # åŸºç¡€å­—æ®µ 
          id: { type: "long" }
          gmt_create: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          gmt_modified: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          deleted: { type: "integer" }
          lock_version: { type: "integer" }
          
          # ç›²ç›’åŸºç¡€ä¿¡æ¯
          name:
            type: "text"
            analyzer: "chinese_text"
            search_analyzer: "chinese_search"
            fields:
              keyword: { type: "keyword" }
          cover: { type: "keyword", index: false }
          detail:
            type: "text"
            analyzer: "chinese_text"
            search_analyzer: "chinese_search"
          identifier: { type: "keyword" }
          state: { type: "keyword" }
          
          # ä»·æ ¼å’Œåº“å­˜
          price: { type: "double" }
          quantity: { type: "integer" }
          saleable_inventory: { type: "integer" }
          occupied_inventory: { type: "integer" }
          frozen_inventory: { type: "integer" }
          
          # æ—¶é—´å­—æ®µ
          create_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          sale_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          sync_chain_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          
          # é¢„çº¦ç›¸å…³
          can_book: { type: "boolean" }
          book_start_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          book_end_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          
          # åˆ›å»ºè€…å’Œé…ç½®
          creator_id: { type: "long" }
          allocate_rule: { type: "text", index: false }
          collection_configs: { type: "text", index: false }

    # ğŸ“‹ è®¢å•ç´¢å¼•
    collide_trade_order:
      settings:
        number_of_shards: 4  # å¯¹åº”4ä¸ªåˆ†ç‰‡è¡¨
        number_of_replicas: 0
      mappings:
        properties:
          # åŸºç¡€å­—æ®µ
          id: { type: "long" }
          gmt_create: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          gmt_modified: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          deleted: { type: "integer" }
          lock_version: { type: "integer" }
          
          # è®¢å•ä¿¡æ¯
          order_id: { type: "keyword" }
          identifier: { type: "keyword" }
          order_state: { type: "keyword" }
          
          # ä¹°å–åŒæ–¹
          buyer_id: { type: "keyword" }
          reverse_buyer_id: { type: "keyword" }
          buyer_type: { type: "keyword" }
          seller_id: { type: "keyword" }
          seller_type: { type: "keyword" }
          
          # å•†å“ä¿¡æ¯
          goods_id: { type: "keyword" }
          goods_type: { type: "keyword" }
          goods_name:
            type: "text"
            analyzer: "chinese_text"
            search_analyzer: "chinese_search"
            fields:
              keyword: { type: "keyword" }
          goods_pic_url: { type: "keyword", index: false }
          
          # ä»·æ ¼å’Œæ•°é‡
          item_price: { type: "double" }
          item_count: { type: "integer" }
          order_amount: { type: "double" }
          paid_amount: { type: "double" }
          
          # æ—¶é—´å­—æ®µ
          pay_succeed_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          order_confirmed_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          order_finished_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          order_closed_time: { type: "date", format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
          
          # æ”¯ä»˜ä¿¡æ¯
          pay_channel: { type: "keyword" }
          pay_stream_id: { type: "keyword" }
          close_type: { type: "keyword" }
          snapshot_version: { type: "integer" }

  # ====================================================================================
  # ç´¢å¼•åˆ«åé…ç½®
  # ====================================================================================
  aliases:
    # ç”¨æˆ·ç›¸å…³åˆ«å
    users_search: ["collide_users"]
    users_analytics: ["collide_users"]
    
    # å†…å®¹ç›¸å…³åˆ«å
    content_search: ["collide_content"]
    content_hot: ["collide_content"]
    
    # å•†å“ç›¸å…³åˆ«å
    goods_search: ["collide_collection", "collide_blind_box"]
    goods_analytics: ["collide_collection", "collide_blind_box"]
    
    # è®¢å•ç›¸å…³åˆ«å
    order_search: ["collide_trade_order"]
    order_analytics: ["collide_trade_order"]

  # ====================================================================================
  # ç´¢å¼•ç”Ÿå‘½å‘¨æœŸé…ç½®
  # ====================================================================================
  lifecycle_policies:
    # æ ‡å‡†ç”Ÿå‘½å‘¨æœŸ
    standard_policy:
      hot_phase: "30d"
      warm_phase: "90d" 
      cold_phase: "365d"
      delete_phase: "2555d"  # 7å¹´
    
    # è®¢å•ç”Ÿå‘½å‘¨æœŸ
    order_policy:
      hot_phase: "7d"
      warm_phase: "30d"
      cold_phase: "180d"
      delete_phase: "1825d"  # 5å¹´

  # ====================================================================================
  # æŸ¥è¯¢æ¨¡æ¿é…ç½®
  # ====================================================================================
  search_templates:
    # é€šç”¨åˆ†é¡µæœç´¢æ¨¡æ¿
    common_page_search:
      template: |
        {
          "from": "{{from}}{{^from}}0{{/from}}",
          "size": "{{size}}{{^size}}10{{/size}}",
          "query": {
            "bool": {
              "must": [
                {{#keyword}}
                {
                  "multi_match": {
                    "query": "{{keyword}}",
                    "fields": [{{#search_fields}}"{{.}}"{{^last}},{{/last}}{{/search_fields}}]
                  }
                }
                {{/keyword}}
              ],
              "filter": [
                {{#filters}}
                {
                  "term": {
                    "{{field}}": "{{value}}"
                  }
                }{{^last}},{{/last}}
                {{/filters}}
              ]
            }
          },
          "sort": [
            {{#sort_fields}}
            {
              "{{field}}": {
                "order": "{{order}}{{^order}}desc{{/order}}"
              }
            }{{^last}},{{/last}}
            {{/sort_fields}}
          ]
        }
    
    # ç»Ÿè®¡èšåˆæ¨¡æ¿
    common_agg_search:
      template: |
        {
          "size": 0,
          "aggs": {
            {{#aggregations}}
            "{{name}}": {
              "{{type}}": {
                "field": "{{field}}"
              }
            }{{^last}},{{/last}}
            {{/aggregations}}
          }
        } 