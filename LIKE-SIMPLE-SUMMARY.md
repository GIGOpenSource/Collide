# Likeæ¨¡å—ç®€æ´ç‰ˆé‡æ„æ€»ç»“

## ğŸ“– æ¦‚è¿°

Likeæ¨¡å—å·²æˆåŠŸé‡æ„ä¸ºç®€æ´ç‰ˆï¼ŒåŸºäº**æ— è¿è¡¨è®¾è®¡åŸåˆ™**å’Œ**KISSåŸåˆ™**ï¼Œä»å¤æ‚çš„40+ä¸ªæ–‡ä»¶ç²¾ç®€ä¸º7ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼Œå®ç°äº†é«˜æ€§èƒ½ã€æ˜“ç»´æŠ¤çš„ç‚¹èµç³»ç»Ÿã€‚

## ğŸ¯ è®¾è®¡åŸåˆ™

### 1. æ— è¿è¡¨è®¾è®¡ (No-Join Design)
- **ç›®æ ‡å¯¹è±¡ä¿¡æ¯å†—ä½™**: å­˜å‚¨`target_title`ã€`target_author_id`
- **ç”¨æˆ·ä¿¡æ¯å†—ä½™**: å­˜å‚¨`user_nickname`ã€`user_avatar`
- **æ€§èƒ½ä¼˜åŒ–**: é¿å…å¤æ‚JOINæŸ¥è¯¢ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡
- **æ•°æ®ä¸€è‡´æ€§**: é€šè¿‡ä¸šåŠ¡é€»è¾‘å±‚ç»´æŠ¤å†—ä½™æ•°æ®åŒæ­¥

### 2. å•è¡¨æ¶æ„
```sql
-- ç‚¹èµä¸»è¡¨ï¼ˆå»è¿è¡¨åŒ–è®¾è®¡ï¼‰
CREATE TABLE `t_like` (
  `id`          BIGINT       NOT NULL AUTO_INCREMENT,
  `like_type`   VARCHAR(20)  NOT NULL,  -- CONTENTã€COMMENTã€DYNAMIC
  `target_id`   BIGINT       NOT NULL,
  `user_id`     BIGINT       NOT NULL,
  
  -- ç›®æ ‡å¯¹è±¡ä¿¡æ¯ï¼ˆå†—ä½™å­—æ®µï¼‰
  `target_title`    VARCHAR(200),
  `target_author_id` BIGINT,
  
  -- ç”¨æˆ·ä¿¡æ¯ï¼ˆå†—ä½™å­—æ®µï¼‰
  `user_nickname`   VARCHAR(100),
  `user_avatar`     VARCHAR(500),
  
  `status`      VARCHAR(20)  NOT NULL DEFAULT 'active',
  `create_time` TIMESTAMP    NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` TIMESTAMP    NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_target` (`user_id`, `like_type`, `target_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### 3. çŠ¶æ€ç®¡ç†
- **active**: æ´»è·ƒç‚¹èµçŠ¶æ€
- **cancelled**: å·²å–æ¶ˆç‚¹èµçŠ¶æ€
- **é€»è¾‘åˆ é™¤**: ä½¿ç”¨çŠ¶æ€æ§åˆ¶è€Œéç‰©ç†åˆ é™¤ï¼Œä¿ç•™å†å²æ•°æ®

## ğŸ“ æ–‡ä»¶ç»“æ„å¯¹æ¯”

### âœ… ç®€æ´ç‰ˆç»“æ„ (7ä¸ªæ ¸å¿ƒæ–‡ä»¶)
```
collide-common/collide-api/src/main/java/com/gig/collide/api/like/
â”œâ”€â”€ LikeFacadeService.java              # APIæ¥å£ (9ä¸ªæ ¸å¿ƒæ–¹æ³•)
â”œâ”€â”€ request/
â”‚   â”œâ”€â”€ LikeRequest.java               # ç‚¹èµè¯·æ±‚
â”‚   â”œâ”€â”€ LikeQueryRequest.java          # æŸ¥è¯¢è¯·æ±‚
â”‚   â”œâ”€â”€ LikeToggleRequest.java         # åˆ‡æ¢è¯·æ±‚
â”‚   â””â”€â”€ LikeCancelRequest.java         # å–æ¶ˆè¯·æ±‚
â””â”€â”€ response/
    â””â”€â”€ LikeResponse.java              # ç»Ÿä¸€å“åº”

collide-application/collide-like/src/main/java/com/gig/collide/like/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entity/Like.java               # å®ä½“ç±»
â”‚   â””â”€â”€ service/
â”‚       â”œâ”€â”€ LikeService.java           # ä¸šåŠ¡æ¥å£
â”‚       â””â”€â”€ impl/LikeServiceImpl.java  # ä¸šåŠ¡å®ç°
â”œâ”€â”€ infrastructure/mapper/
â”‚   â”œâ”€â”€ LikeMapper.java               # æ•°æ®è®¿é—®æ¥å£
â”‚   â””â”€â”€ LikeMapper.xml                # MyBatisæ˜ å°„
â”œâ”€â”€ facade/LikeFacadeServiceImpl.java  # Dubboå®ç°
â”œâ”€â”€ controller/LikeController.java     # RESTæ§åˆ¶å™¨
â””â”€â”€ CollideLikeApplication.java        # å¯åŠ¨ç±»
```

### âŒ åŸå¤æ‚ç‰ˆç»“æ„ (40+ä¸ªæ–‡ä»¶)
- 15+ä¸ªå¤æ‚ç»Ÿè®¡è¯·æ±‚ç±»
- 17+ä¸ªå¤æ‚ç»Ÿè®¡å“åº”ç±»
- condition/ å¤æ‚æ¡ä»¶ç›®å½•
- data/ å¤æ‚æ•°æ®ç›®å½•
- å¤šå±‚åµŒå¥—çš„ä¸šåŠ¡é€»è¾‘
- å¤æ‚çš„å…³è”æŸ¥è¯¢å’Œç»Ÿè®¡åŠŸèƒ½

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Dubbo RPC     â”‚    â”‚   HTTP REST     â”‚
â”‚  (è¿œç¨‹è°ƒç”¨)      â”‚    â”‚   (Webæ¥å£)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Facade Layer                 â”‚
â”‚   LikeFacadeServiceImpl.java           â”‚
â”‚   (DTOè½¬æ¢ + å¼‚å¸¸å¤„ç†)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Service Layer                 â”‚
â”‚   LikeServiceImpl.java                 â”‚
â”‚   (ä¸šåŠ¡é€»è¾‘ + äº‹åŠ¡ç®¡ç†)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Data Layer                   â”‚
â”‚   LikeMapper.java + LikeMapper.xml     â”‚
â”‚   (æ•°æ®è®¿é—® + SQLæ˜ å°„)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Database                      â”‚
â”‚         t_like (å•è¡¨)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš¡ æ ¸å¿ƒåŠŸèƒ½

### 1. ç‚¹èµæ“ä½œ
- **æ·»åŠ ç‚¹èµ**: æ”¯æŒå†—ä½™ä¿¡æ¯å­˜å‚¨
- **å–æ¶ˆç‚¹èµ**: çŠ¶æ€æ›´æ–°ä¸ºcancelled
- **åˆ‡æ¢ç‚¹èµ**: æ™ºèƒ½åˆ‡æ¢ç‚¹èµçŠ¶æ€
- **é‡å¤ç‚¹èµå¤„ç†**: é˜²æ­¢é‡å¤ç‚¹èµï¼Œé‡æ–°æ¿€æ´»å·²å–æ¶ˆçš„ç‚¹èµ

### 2. æŸ¥è¯¢åŠŸèƒ½
- **åˆ†é¡µæŸ¥è¯¢**: æ”¯æŒå¤šæ¡ä»¶ç»„åˆæŸ¥è¯¢
- **çŠ¶æ€æ£€æŸ¥**: å¿«é€Ÿæ£€æŸ¥ç‚¹èµçŠ¶æ€
- **æ‰¹é‡æ£€æŸ¥**: ä¸€æ¬¡æ£€æŸ¥å¤šä¸ªç›®æ ‡å¯¹è±¡çš„ç‚¹èµçŠ¶æ€
- **ç»Ÿè®¡è®¡æ•°**: è·å–ç‚¹èµæ•°é‡ç»Ÿè®¡

### 3. é«˜çº§ç‰¹æ€§
- **äº‹åŠ¡ç®¡ç†**: ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- **å‚æ•°éªŒè¯**: å®Œæ•´çš„ä¸šåŠ¡å‚æ•°éªŒè¯
- **å¼‚å¸¸å¤„ç†**: ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
- **æ—¥å¿—è®°å½•**: è¯¦ç»†çš„æ“ä½œæ—¥å¿—

## ğŸ”§ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæŠ€æœ¯
- **Spring Boot**: åº”ç”¨æ¡†æ¶
- **MyBatis-Plus**: ORMæ¡†æ¶ï¼Œç®€åŒ–æ•°æ®è®¿é—®
- **Dubbo**: RPCè¿œç¨‹è°ƒç”¨
- **MySQL**: æ•°æ®å­˜å‚¨
- **Lombok**: å‡å°‘æ ·æ¿ä»£ç 

### ä¾èµ–ç»„ä»¶
- **Spring Transaction**: äº‹åŠ¡ç®¡ç†
- **Jakarta Validation**: å‚æ•°éªŒè¯
- **Swagger**: APIæ–‡æ¡£
- **SLF4J**: æ—¥å¿—è®°å½•

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–
- **å•è¡¨æŸ¥è¯¢**: é¿å…å¤æ‚JOINæ“ä½œ
- **ç´¢å¼•è®¾è®¡**: 
  - ä¸»é”®ç´¢å¼•: `id`
  - å”¯ä¸€ç´¢å¼•: `uk_user_target` (é˜²é‡å¤)
  - æ™®é€šç´¢å¼•: `idx_target_id`, `idx_user_id`, `idx_like_type`, `idx_status`

### 2. æŸ¥è¯¢ä¼˜åŒ–
- **å†—ä½™å­˜å‚¨**: é¿å…å…³è”æŸ¥è¯¢
- **åˆ†é¡µæŸ¥è¯¢**: ä½¿ç”¨MyBatis-Plusåˆ†é¡µæ’ä»¶
- **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡æ£€æŸ¥ç‚¹èµçŠ¶æ€
- **æ¡ä»¶æŸ¥è¯¢**: åŠ¨æ€SQLæ¡ä»¶æ‹¼æ¥

### 3. ç¼“å­˜ç­–ç•¥
- **å®ä½“ç¼“å­˜**: MyBatis-Plusä¸€çº§ç¼“å­˜
- **æŸ¥è¯¢ç¼“å­˜**: é¢„ç•™Redisç¼“å­˜æ¥å£
- **è®¡æ•°ç¼“å­˜**: å¯æ‰©å±•è®¡æ•°å™¨ç¼“å­˜

## ğŸ“Š APIæ¥å£

### Dubbo RPCæ¥å£
```java
// æ ¸å¿ƒä¸šåŠ¡æ–¹æ³•
Result<LikeResponse> addLike(LikeRequest request);
Result<Void> cancelLike(LikeCancelRequest request);
Result<LikeResponse> toggleLike(LikeToggleRequest request);
Result<Boolean> checkLikeStatus(Long userId, String likeType, Long targetId);
Result<PageResponse<LikeResponse>> queryLikes(LikeQueryRequest request);
Result<Long> getLikeCount(String likeType, Long targetId);
Result<Long> getUserLikeCount(Long userId, String likeType);
Result<Map<Long, Boolean>> batchCheckLikeStatus(Long userId, String likeType, List<Long> targetIds);
```

### HTTP RESTæ¥å£
```http
POST   /api/like/add           # æ·»åŠ ç‚¹èµ
POST   /api/like/cancel        # å–æ¶ˆç‚¹èµ
POST   /api/like/toggle        # åˆ‡æ¢ç‚¹èµçŠ¶æ€
GET    /api/like/check         # æ£€æŸ¥ç‚¹èµçŠ¶æ€
GET    /api/like/query         # åˆ†é¡µæŸ¥è¯¢ç‚¹èµè®°å½•
GET    /api/like/count         # è·å–ç‚¹èµæ•°é‡
GET    /api/like/user/count    # è·å–ç”¨æˆ·ç‚¹èµæ•°é‡
POST   /api/like/batch/check   # æ‰¹é‡æ£€æŸ¥ç‚¹èµçŠ¶æ€
```

## ğŸ“ˆ ç®€åŒ–æ•ˆæœ

### æ•°é‡å¯¹æ¯”
| é¡¹ç›® | åŸå¤æ‚ç‰ˆ | ç®€æ´ç‰ˆ | ç®€åŒ–ç‡ |
|-----|---------|--------|--------|
| æ–‡ä»¶æ€»æ•° | 40+ | 7 | 82.5% |
| APIæ–¹æ³• | 20+ | 9 | 55% |
| æ•°æ®è¡¨ | 3+ | 1 | 66.7% |
| SQLå¤æ‚åº¦ | é«˜ | ä½ | æ˜¾è‘—é™ä½ |

### ç»´æŠ¤æ€§æå‡
- **ä»£ç å¯è¯»æ€§**: ç®€æ´æ˜äº†çš„ä¸šåŠ¡é€»è¾‘
- **æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°çš„ç‚¹èµç±»å‹
- **æµ‹è¯•æ€§**: å•ä¸€èŒè´£ï¼Œæ˜“äºå•å…ƒæµ‹è¯•
- **æ–‡æ¡£æ€§**: è¯¦ç»†çš„æ³¨é‡Šå’ŒAPIæ–‡æ¡£

## ğŸ¯ æ”¯æŒçš„ç‚¹èµç±»å‹

1. **CONTENT**: å†…å®¹ç‚¹èµï¼ˆæ–‡ç« ã€è§†é¢‘ç­‰ï¼‰
2. **COMMENT**: è¯„è®ºç‚¹èµ
3. **DYNAMIC**: åŠ¨æ€ç‚¹èµï¼ˆæœ‹å‹åœˆã€çŠ¶æ€ç­‰ï¼‰

## âœ… å®Œæˆæ¸…å•

- [x] æ–‡ä»¶æ¸…ç† - åˆ é™¤40+ä¸ªå¤æ‚æ–‡ä»¶
- [x] APIæ¥å£é‡æ„ - LikeFacadeService
- [x] Request/Responseé‡æ„ - 4ä¸ªè¯·æ±‚ç±» + 1ä¸ªå“åº”ç±»
- [x] å®ä½“ç±»åˆ›å»º - Like.java (å¯¹åº”t_likeè¡¨)
- [x] æ•°æ®è®¿é—®å±‚ - LikeMapper + XMLæ˜ å°„
- [x] ä¸šåŠ¡é€»è¾‘å±‚ - LikeService + å®ç°ç±»
- [x] DubboæœåŠ¡å±‚ - LikeFacadeServiceImpl
- [x] RESTæ§åˆ¶å™¨ - LikeController
- [x] å¯åŠ¨ç±»æ›´æ–° - CollideLikeApplication
- [x] æ–‡æ¡£æ€»ç»“ - æœ¬æ–‡æ¡£

## ğŸŠ æ€»ç»“

Likeæ¨¡å—ç®€æ´ç‰ˆé‡æ„å–å¾—äº†æ˜¾è‘—æˆæ•ˆï¼š

1. **å¤§å¹…ç®€åŒ–**: ä»40+ä¸ªæ–‡ä»¶ç²¾ç®€åˆ°7ä¸ªæ ¸å¿ƒæ–‡ä»¶
2. **æ€§èƒ½æå‡**: æ— è¿è¡¨è®¾è®¡ï¼ŒæŸ¥è¯¢æ•ˆç‡æ˜¾è‘—æé«˜
3. **æ˜“äºç»´æŠ¤**: æ¸…æ™°çš„åˆ†å±‚æ¶æ„ï¼Œç®€æ´çš„ä¸šåŠ¡é€»è¾‘
4. **åŠŸèƒ½å®Œæ•´**: ä¿ç•™æ‰€æœ‰æ ¸å¿ƒç‚¹èµåŠŸèƒ½
5. **æ‰©å±•æ€§å¼º**: æ”¯æŒæ–°ç‚¹èµç±»å‹çš„è½»æ¾æ‰©å±•

è¿™æ¬¡é‡æ„å®Œç¾ä½“ç°äº†**"ç®€æ´å³ç¾"**çš„è®¾è®¡å“²å­¦ï¼Œä¸ºåç»­æ¨¡å—é‡æ„æä¾›äº†ä¼˜ç§€çš„èŒƒä¾‹ï¼ ğŸŒŸ